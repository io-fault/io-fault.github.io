<html root="2"><head><title>system.python.source</title><meta charset="utf-8"/><link as="style" rel="preload" href="../../.legacy-web/core.css"></link><link as="style" rel="preload" href="../../.legacy-web/factor.css"></link><link rel="stylesheet" href="../../.legacy-web/core.css"></link><link rel="stylesheet" href="../../.legacy-web/factor.css"></link></head><body><main><h1><span class="prefix"></span><div class="page-subject"><img class="icon" src="../../.factor-type-icon/if.fault.io/python-module.svg"></img><span class="subject-identifier">source</span><span class="element-status"><span class="nothing-missed">0</span></span><a href="http://if.fault.io/factors/python.module"><code class="type">python.module</code></a></div><div class="page-context"><a href="../"><img class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTYiIGhlaWdodD0iMjU2Ij48dGV4dCB4PSI0IiB5PSIwLjg4ZW0iIGZvbnQtc2l6ZT0iMjQ4Ij7wn5CNPC90ZXh0Pjwvc3ZnPg=="></img></a><span class="context-identifier">system.python</span></div></h1><section class="chapter"><p><span class="text.normal">Python source (AST) processing tools.</span></p></section><section class="import" documented="false" local-identifier="ast" id="ast"><h1><span class="prefix"></span><a class="title" href="#ast"><span class="text.normal">ast</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="tokenize" id="tokenize"><h1><span class="prefix"></span><a class="title" href="#tokenize"><span class="text.normal">tokenize</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="itertools" id="itertools"><h1><span class="prefix"></span><a class="title" href="#itertools"><span class="text.normal">itertools</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="collections" id="collections"><h1><span class="prefix"></span><a class="title" href="#collections"><span class="text.normal">collections</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="functools" id="functools"><h1><span class="prefix"></span><a class="title" href="#functools"><span class="text.normal">functools</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="builtins" id="builtins"><h1><span class="prefix"></span><a class="title" href="#builtins"><span class="text.normal">builtins</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="module" id="module"><h1><span class="prefix"></span><a class="title" href="#module"><span class="text.normal">module</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="data" documented="false" local-identifier="insignificant" id="insignificant"><h1><span class="prefix"></span><a class="title" href="#insignificant"><span class="text.normal">insignificant</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">insignificant = set([
	tokenize.ENCODING,
	tokenize.ENDMARKER,
	tokenize.INDENT,
	tokenize.DEDENT,
	tokenize.NL,
	tokenize.NEWLINE,
	tokenize.COMMENT,
])
</code></pre></section><section class="data" documented="false" local-identifier="InlineComprehension" id="InlineComprehension"><h1><span class="prefix"></span><a class="title" href="#InlineComprehension"><span class="text.normal">InlineComprehension</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">InlineComprehension = (
	ast.ListComp,
	ast.GeneratorExp,
	ast.DictComp,
)
</code></pre></section><section class="data" documented="false" local-identifier="InterruptNodes" id="InterruptNodes"><h1><span class="prefix"></span><a class="title" href="#InterruptNodes"><span class="text.normal">InterruptNodes</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">InterruptNodes = (
	ast.Break,
	ast.Continue,
	ast.Raise,
	ast.Return,
	ast.Yield,
	ast.YieldFrom,
)
</code></pre></section><section class="function" documented="false" local-identifier="sequence_nodes" id="sequence_nodes"><h1><span class="prefix"></span><a class="title" href="#sequence_nodes"><span class="text.normal">sequence_nodes</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">sequence_nodes(node_list)</code></p></section><section class="function" documented="true" local-identifier="shallow" id="shallow"><h1><span class="prefix"></span><a class="title" href="#shallow"><span class="text.normal">shallow</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">shallow(node)</code></p><p><a class="none" href="http://fault.io/dev/null"><span class="invalid">ast.iter_child_nodes</span></a><span class="text.normal"> implementation providing path context for node substitution.</span></p></section><section class="function" documented="true" local-identifier="bottom" id="bottom"><h1><span class="prefix"></span><a class="title" href="#bottom"><span class="text.normal">bottom</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">bottom(tree)</code></p><p><a class="none" href="http://fault.io/dev/null"><span class="invalid">ast.walk</span></a><span class="text.normal"> implementation providing path context for node substitution.</span></p></section><section class="function" documented="true" local-identifier="node_set_address" id="node_set_address"><h1><span class="prefix"></span><a class="title" href="#node_set_address"><span class="text.normal">node_set_address</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">node_set_address(node, address)</code></p><p><span class="text.normal">Set the </span><code class="">lineno</code><span class="text.normal"> and </span><code class="">col_offset</code><span class="text.normal"> attributes on the </span><a class="factor-local" href="#node_set_address.Parameters.node"><span class="parameter">node</span></a><span class="text.normal">.</span></p></section><section class="function" documented="true" local-identifier="node_remove_docstring" id="node_remove_docstring"><h1><span class="prefix"></span><a class="title" href="#node_remove_docstring"><span class="text.normal">node_remove_docstring</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">node_remove_docstring(container)</code></p><p><span class="text.normal">Remove the initial </span><a class="none" href="http://fault.io/dev/null"><span class="invalid">ast.Expr</span></a><span class="text.normal"> node in the body of </span><a class="factor-local" href="#node_remove_docstring.Parameters.container"><span class="parameter">container</span></a><span class="text.normal"> given</span><span class="text.line-break"> </span><span class="text.normal">that it has the properties that would identify it as the docstring source.</span></p></section><section class="function" documented="true" local-identifier="associate_siblings" id="associate_siblings"><h1><span class="prefix"></span><a class="title" href="#associate_siblings"><span class="text.normal">associate_siblings</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">associate_siblings(following, nodes)</code></p><p><span class="text.normal">Associate the child nodes of </span><a class="factor-local" href="#associate_siblings.Parameters.nodes"><span class="parameter">nodes</span></a><span class="text.normal"> with their following</span><span class="text.line-break"> </span><span class="text.normal">sibling taking care to communicate the parent's following</span><span class="text.line-break"> </span><span class="text.normal">sibling for the final child.</span></p><p><a class="factor-local" href="#associate_siblings.Parameters.following"><span class="parameter">following</span></a><span class="text.normal"> can be </span><a class="invalid" href="#None"><span class="unknown">None</span></a><span class="text.normal"> if the node is at the end of the document.</span></p></section><section class="function" documented="true" local-identifier="map_tokens" id="map_tokens"><h1><span class="prefix"></span><a class="title" href="#map_tokens"><span class="text.normal">map_tokens</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">map_tokens(tokens)</code></p><p><span class="text.normal">Construct a dictionary associating addresses with their corresponding token.</span></p></section><section class="function" documented="false" local-identifier="count_trailing_insignificant" id="count_trailing_insignificant"><h1><span class="prefix"></span><a class="title" href="#count_trailing_insignificant"><span class="text.normal">count_trailing_insignificant</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">count_trailing_insignificant(tokens)</code></p></section><section class="function" documented="true" local-identifier="identify_boundary" id="identify_boundary"><h1><span class="prefix"></span><a class="title" href="#identify_boundary"><span class="text.normal">identify_boundary</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">identify_boundary(tokens, start, end)</code></p><p><span class="text.normal">Narrows the token window by trimming insignificant (whitespace or certain keywords) tokens</span><span class="text.line-break"> </span><span class="text.normal">from the list.</span></p><p><span class="text.normal">The default token sequence for a node is constrained by the node's location and its</span><span class="text.line-break"> </span><span class="text.normal">identified following sibling, </span><a class="factor-local" href="#associate_siblings"><span class="function">associate_siblings</span></a><span class="text.normal">.</span></p></section><section class="function" documented="true" local-identifier="find_terminal" id="find_terminal"><h1><span class="prefix"></span><a class="title" href="#find_terminal"><span class="text.normal">find_terminal</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">find_terminal(tokens, length)</code></p><p><span class="text.normal">Find the end of the context tokens.</span></p></section><section class="function" documented="false" local-identifier="find_token" id="find_token"><h1><span class="prefix"></span><a class="title" href="#find_token"><span class="text.normal">find_token</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">find_token(tokens, token_type)</code></p></section><section class="function" documented="false" local-identifier="find_newline" id="find_newline"><h1><span class="prefix"></span><a class="title" href="#find_newline"><span class="text.normal">find_newline</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">find_newline(tokens)</code></p></section><section class="function" documented="false" local-identifier="find_token_with_string" id="find_token_with_string"><h1><span class="prefix"></span><a class="title" href="#find_token_with_string"><span class="text.normal">find_token_with_string</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">find_token_with_string(tokens, token_type, string)</code></p></section><section class="function" documented="false" local-identifier="isolate_enclosure" id="isolate_enclosure"><h1><span class="prefix"></span><a class="title" href="#isolate_enclosure"><span class="text.normal">isolate_enclosure</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">isolate_enclosure(start, stop)</code></p></section><section class="function" documented="true" local-identifier="isolate_name" id="isolate_name"><h1><span class="prefix"></span><a class="title" href="#isolate_name"><span class="text.normal">isolate_name</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">isolate_name(tokens)</code></p><p><span class="text.normal">Return the first NAME token in </span><a class="factor-local" href="#isolate_name.Parameters.tokens"><span class="parameter">tokens</span></a><span class="text.normal"> and remove it along with the</span><span class="text.line-break"> </span><span class="text.normal">ones that preceded it.</span></p></section><section class="function" documented="true" local-identifier="isolate_number" id="isolate_number"><h1><span class="prefix"></span><a class="title" href="#isolate_number"><span class="text.normal">isolate_number</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">isolate_number(tokens)</code></p><p><span class="text.normal">Return the first NAME token in </span><a class="factor-local" href="#isolate_number.Parameters.tokens"><span class="parameter">tokens</span></a><span class="text.normal"> and remove it along with the</span><span class="text.line-break"> </span><span class="text.normal">ones that preceded it.</span></p></section><section class="function" documented="false" local-identifier="isolate_string" id="isolate_string"><h1><span class="prefix"></span><a class="title" href="#isolate_string"><span class="text.normal">isolate_string</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">isolate_string(tokens)</code></p></section><section class="data" documented="false" local-identifier="isolate" id="isolate"><h1><span class="prefix"></span><a class="title" href="#isolate"><span class="text.normal">isolate</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">	# Return the first NAME token in &#38;tokens and remove it along with the
	# ones that preceded it.
	"""

	k = find_token(tokens, NUMBER)
	t_offset, t = k
	del tokens[:t_offset+1]
	return t, t, t.start, t.end

def isolate_string(tokens, STRING=tokenize.STRING, enum=enumerate):
	t_offset, first = find_token(tokens, STRING)
	del tokens[:t_offset+1]

	last = first
</code></pre></section><section class="function" documented="true" local-identifier="chain" id="chain"><h1><span class="prefix"></span><a class="title" href="#chain"><span class="text.normal">chain</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">chain(tokens, nodes, node, address, following)</code></p><p><span class="text.normal">Delineate a chain of nodes that are identified by the same address.</span></p></section><section class="function" documented="true" local-identifier="trim" id="trim"><h1><span class="prefix"></span><a class="title" href="#trim"><span class="text.normal">trim</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">trim(tokens)</code></p><p><span class="text.normal">Identify the number of trailing whitespace tokens and remove them from the list.</span></p></section><section class="data" documented="false" local-identifier="chain_classes" id="chain_classes"><h1><span class="prefix"></span><a class="title" href="#chain_classes"><span class="text.normal">chain_classes</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">
</code></pre></section><section class="function" documented="true" local-identifier="areas" id="areas"><h1><span class="prefix"></span><a class="title" href="#areas"><span class="text.normal">areas</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">areas(token_map, tokens, context, node, address, following)</code></p><p><span class="text.normal">Given a node and the tokens from the start of the node,</span><span class="text.line-break"> </span><span class="text.normal">to the next following sibling node, identify the actual</span><span class="text.line-break"> </span><span class="text.normal">stop address of the node filtering whitespace backwards,</span><span class="text.line-break"> </span><span class="text.normal">and balancing nesting operators forward.</span></p></section><section class="function" documented="false" local-identifier="_lookup_region" id="_lookup_region"><h1><span class="prefix"></span><a class="title" href="#_lookup_region"><span class="text.normal">_lookup_region</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">_lookup_region(associations, contexts, tokens, tmap, node)</code></p></section><section class="function" documented="true" local-identifier="join" id="join"><h1><span class="prefix"></span><a class="title" href="#join"><span class="text.normal">join</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">join(lookup, nodes)</code></p><p><span class="text.normal">Assign the address information provided by </span><a class="factor-local" href="#join.Parameters.lookup"><span class="parameter">lookup</span></a><span class="text.normal"> to the nodes</span><span class="text.line-break"> </span><span class="text.normal">generated by the </span><a class="factor-local" href="#join.Parameters.nodes"><span class="parameter">nodes</span></a><span class="text.normal"> iterator.</span></p></section><section class="function" documented="false" local-identifier="_prepare" id="_prepare"><h1><span class="prefix"></span><a class="title" href="#_prepare"><span class="text.normal">_prepare</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">_prepare(nodes, tokens)</code></p></section><section class="function" documented="true" local-identifier="shift_column" id="shift_column"><h1><span class="prefix"></span><a class="title" href="#shift_column"><span class="text.normal">shift_column</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">shift_column(lines, ln, co)</code></p><p><span class="text.normal">Adjust the </span><a class="invalid" href="#str"><span class="unknown">str</span></a><span class="text.normal"> column offset, </span><a class="factor-local" href="#shift_column.Parameters.co"><span class="parameter">co</span></a><span class="text.normal">, to its utf-8 position.</span></p><section class="unspecified" documented="true" local-identifier="Parameters" id="shift_column.Parameters"><h1 class="integrate"><span class="prefix"></span><a class="section" href="#shift_column">shift_column</a><a class="title" href="#shift_column.Parameters"><span class="text.normal">Parameters</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type"></span></div></h1><dl class="text.mapping"><div id="shift_column.Parameters.lines" class="parameter" documented="true"><dt><a class="dkn" href="#shift_column.Parameters.lines"></a><span class="directory-key"><code class="parameter">lines</code></span></dt><dd><div class="status"></div><p><span class="text.normal">The source as a sequence of lines.</span></p></dd></div><div id="shift_column.Parameters.ln" class="parameter" documented="true"><dt><a class="dkn" href="#shift_column.Parameters.ln"></a><span class="directory-key"><code class="parameter">ln</code></span></dt><dd><div class="status"></div><p><span class="text.normal">The line number in </span><a class="factor-local" href="#shift_column.Parameters.lines"><span class="parameter">lines</span></a><span class="text.normal">.</span></p></dd></div><div id="shift_column.Parameters.co" class="parameter" documented="true"><dt><a class="dkn" href="#shift_column.Parameters.co"></a><span class="directory-key"><code class="parameter">co</code></span></dt><dd><div class="status"></div><p><span class="text.normal">The column in the line's </span><a class="invalid" href="#str"><span class="unknown">str</span></a><span class="text.normal"> that will be</span><span class="text.line-break"> </span><span class="text.normal">adjusted into its </span><code class="">utf-8</code><span class="text.normal"> position.</span></p></dd></div><div id="shift_column.Parameters.encoding" class="parameter" documented="false"><dt><a class="dkn" href="#shift_column.Parameters.encoding"></a><span class="directory-key"><code class="parameter">encoding</code></span></dt><dd><div class="status"></div><p><code class="control.absent">Undocumented</code><span class="text.normal">.</span></p></dd></div></dl></section><section class="unspecified" documented="true" local-identifier="Returns" id="shift_column.Returns"><h1 class="integrate"><span class="prefix"></span><a class="section" href="#shift_column">shift_column</a><a class="title" href="#shift_column.Returns"><span class="text.normal">Returns</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type"></span></div></h1><p><span class="text.normal">Line number and column offset as a tuple.</span></p></section></section><section class="function" documented="true" local-identifier="parse" id="parse"><h1><span class="prefix"></span><a class="title" href="#parse"><span class="text.normal">parse</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">parse(source, path)</code></p><p><span class="text.normal">Parse the given </span><a class="factor-local" href="#parse.Parameters.source"><span class="parameter">source</span></a><span class="text.normal"> creating an </span><a class="none" href="http://fault.io/dev/null"><span class="invalid">ast.Module</span></a><span class="text.normal"> whose child nodes have their exact areas</span><span class="text.line-break"> </span><span class="text.normal">assigned to the </span><code class="">_f_area</code><span class="text.normal"> attribute.</span></p></section><h1 class="footing"></h1></main></body></html>