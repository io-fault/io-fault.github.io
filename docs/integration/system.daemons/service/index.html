<html root="2"><head><title>system.daemons.service</title><meta charset="utf-8"/><link as="style" rel="preload" href="../../.legacy-web/core.css"></link><link as="style" rel="preload" href="../../.legacy-web/factor.css"></link><link rel="stylesheet" href="../../.legacy-web/core.css"></link><link rel="stylesheet" href="../../.legacy-web/factor.css"></link></head><body><main><h1><span class="prefix"></span><div class="page-subject"><img class="icon" src="../../.factor-type-icon/if.fault.io/python-module.svg"></img><span class="subject-identifier">service</span><span class="element-status"><span class="nothing-missed">0</span></span><a href="http://if.fault.io/factors/python.module"><code class="type">python.module</code></a></div><div class="page-context"><a href="../"><img class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTYiIGhlaWdodD0iMjU2Ij48dGV4dCB4PSI0IiB5PSIwLjg4ZW0iIGZvbnQtc2l6ZT0iMjQ4Ij7wn5G/PC90ZXh0Pjwvc3ZnPg=="></img></a><span class="context-identifier">system.daemons</span></div></h1><section class="chapter"><p><span class="text.normal">Service configuration interfaces.</span></p><p><span class="text.normal">Manages the service state stored on disk.</span></p></section><section class="unspecified" documented="true" local-identifier="Properties" id="Properties"><h1><span class="prefix"></span><a class="title" href="#Properties"><span class="text.normal">Properties</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type"></span></div></h1><dl class="text.mapping"><div id="Properties.environment" documented="true"><dt><a class="dkn" href="#Properties.environment"></a><span class="directory-key"><span class="text.normal">environment</span></span></dt><dd><div class="status"></div><p><span class="text.normal">The environment variable that will be referenced in order</span><span class="text.line-break"> </span><span class="text.normal">to identify the default service directory override.</span></p></dd></div><div id="Properties.default_route" documented="true"><dt><a class="dkn" href="#Properties.default_route"></a><span class="directory-key"><span class="text.normal">default_route</span></span></dt><dd><div class="status"></div><p><span class="text.normal">A </span><a class="remote" href="http://fault.io/python/system/files#Path"><span class="factor-element">fault.system.files.Path</span></a><span class="text.normal"> instance pointing to the default route</span><span class="text.line-break"> </span><span class="text.normal">relative to the user's home directory. (~/.fault)</span></p></dd></div></dl></section><section class="import" documented="false" local-identifier="os" id="os"><h1><span class="prefix"></span><a class="title" href="#os"><span class="text.normal">os</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="sys" id="sys"><h1><span class="prefix"></span><a class="title" href="#sys"><span class="text.normal">sys</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="itertools" id="itertools"><h1><span class="prefix"></span><a class="title" href="#itertools"><span class="text.normal">itertools</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="Path" id="Path"><h1><span class="prefix"></span><a class="title" href="#Path"><span class="text.normal">Path</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="query" id="query"><h1><span class="prefix"></span><a class="title" href="#query"><span class="text.normal">query</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="libexec" id="libexec"><h1><span class="prefix"></span><a class="title" href="#libexec"><span class="text.normal">libexec</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="data" documented="false" local-identifier="environment" id="environment"><h1><span class="prefix"></span><a class="title" href="#environment"><span class="text.normal">environment</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">environment = 'DAEMONS'
</code></pre></section><section class="data" documented="false" local-identifier="default_route" id="default_route"><h1><span class="prefix"></span><a class="title" href="#default_route"><span class="text.normal">default_route</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">default_route = query.home() / '.rootd'
</code></pre></section><section class="data" documented="false" local-identifier="default_daemons" id="default_daemons"><h1><span class="prefix"></span><a class="title" href="#default_daemons"><span class="text.normal">default_daemons</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">default_daemons = default_route * '.daemons'
</code></pre></section><section class="function" documented="true" local-identifier="identify_route" id="identify_route"><h1><span class="prefix"></span><a class="title" href="#identify_route"><span class="text.normal">identify_route</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">identify_route()</code></p><p><span class="text.normal">Return the service directory route.</span></p></section><section class="function" documented="true" local-identifier="service_routes" id="service_routes"><h1><span class="prefix"></span><a class="title" href="#service_routes"><span class="text.normal">service_routes</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">function</span></div></h1><p><code class="signature">service_routes(route)</code></p><p><span class="text.normal">Collect the routes to the set of services in the directory.</span><span class="text.line-break"> </span><span class="text.normal">Regular files existing in </span><a class="factor-local" href="#service_routes.Parameters.route"><span class="parameter">route</span></a><span class="text.normal"> are ignored.</span></p></section><section class="data" documented="false" local-identifier="_actuation_map" id="_actuation_map"><h1><span class="prefix"></span><a class="title" href="#_actuation_map"><span class="text.normal">_actuation_map</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">_actuation_map = {'enabled':True, 'disabled':False, True:'enabled', False:'disabled'}
</code></pre></section><section class="class" documented="true" local-identifier="Configuration" id="Configuration"><h1><span class="prefix"></span><a class="title" href="#Configuration"><span class="text.normal">Configuration</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">class</span></div></h1><div class="inheritance"><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></div><p><span class="text.normal">Service configuration storage interface.</span></p><section class="method" documented="true" local-identifier="initialized" id="Configuration.initialized"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.initialized"><span class="text.normal">initialized</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">initialized(self)</code></p><p><span class="text.normal">Whether the service's configuration directory exists.</span></p></section><section class="method" documented="true" local-identifier="prepare" id="Configuration.prepare"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.prepare"><span class="text.normal">prepare</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">prepare(self)</code></p><p><span class="text.normal">Create the service directory.</span></p></section><section class="method" documented="true" local-identifier="void" id="Configuration.void"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.void"><span class="text.normal">void</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">void(self)</code></p><p><span class="text.normal">Destroy the service directory.</span></p></section><section class="method" documented="false" local-identifier="snapshot" id="Configuration.snapshot"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.snapshot"><span class="text.normal">snapshot</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">snapshot(self)</code></p></section><section class="data" documented="false" local-identifier="fields" id="Configuration.fields"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.fields"><span class="text.normal">fields</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">fields = ('executable', 'parameters', 'environment', 'abstract', 'actuation')
</code></pre></section><section class="method" documented="true" local-identifier="update" id="Configuration.update"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.update"><span class="text.normal">update</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">update(self, fm)</code></p><p><span class="text.normal">Overwrite configuration fields present in the given mapping, </span><a class="factor-local" href="#Configuration.update.Parameters.fm"><span class="parameter">fm</span></a><span class="text.normal">.</span><span class="text.line-break"> </span><span class="text.normal">No merge logic is applied; the value in the mapping will replace the attribute value.</span></p></section><section class="method" documented="true" local-identifier="__init__" id="Configuration.__init__"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.__init__"><span class="text.normal">__init__</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__init__(self, route, identifier)</code></p><p><span class="text.normal">Initialize the Service structure selecting the </span><a class="factor-local" href="#Configuration.__init__.Parameters.route"><span class="parameter">route</span></a><span class="text.normal"> as its</span><span class="text.line-break"> </span><span class="text.normal">storage location. The </span><a class="factor-local" href="#Configuration.__init__.Parameters.route"><span class="parameter">route</span></a><span class="text.normal"> may not exist upon instantiation</span><span class="text.line-break"> </span><span class="text.normal">as it may be the first use in which the user may choose to</span><span class="text.line-break"> </span><span class="text.normal">initialize a directory or merely check for whether it is</span><span class="text.line-break"> </span><span class="text.normal">a service at all.</span></p></section><section class="method" documented="true" local-identifier="trim" id="Configuration.trim"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.trim"><span class="text.normal">trim</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">trim(self)</code></p><p><span class="text.normal">Trim the critical log in the service's directory.</span></p><div class="admonition-PENDING"><table><tr><td><span class="admonition.icon"></span></td><td><span class="admonition.severity">PENDING</span></td></tr><tr><td></td><td><div class="admonition.content"><p><span class="text.normal">Not implemented.</span></p></div></td></tr></table></div></section><section class="method" documented="true" local-identifier="execution" id="Configuration.execution"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.execution"><span class="text.normal">execution</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">execution(self)</code></p><p><span class="text.normal">Return a tuple consisting of the executable and the parameters.</span></p></section><section class="method" documented="true" local-identifier="execute" id="Configuration.execute"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.execute"><span class="text.normal">execute</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">execute(self)</code></p><p><span class="text.normal">Execute the service replacing the process image. </span><a class="factor-local" href="#Configuration.execute"><span class="method">execute</span></a><span class="text.normal"> does not return.</span></p><p><span class="text.normal">Environment variables will be updated by the running process,</span><span class="text.line-break"> </span><span class="text.normal">the current working directory will be switched to service's directory,</span><span class="text.line-break"> </span><a class="invalid" href="#route"><span class="unknown">route</span></a><span class="text.normal">, and the service with be executed according to the current</span><span class="text.line-break"> </span><span class="text.normal">working settings assigned to </span><a class="factor-local" href="#Configuration.execute.Parameters.self"><span class="parameter">self</span></a><span class="text.normal">.</span></p><p><span class="text.normal">A call to </span><a class="factor-local" href="#Configuration.load"><span class="method">load</span></a><span class="text.normal"> prior to running this is often reasonable.</span></p></section><section class="method" documented="true" local-identifier="create" id="Configuration.create"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.create"><span class="text.normal">create</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">create(self)</code></p><p><span class="text.normal">Create the service directory and initialize many of the configuration files.</span></p></section><section class="method" documented="true" local-identifier="exists" id="Configuration.exists"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.exists"><span class="text.normal">exists</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">exists(self)</code></p><p><span class="text.normal">Whether or not the service directory exists.</span></p></section><section class="method" documented="true" local-identifier="isconsistent" id="Configuration.isconsistent"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.isconsistent"><span class="text.normal">isconsistent</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">isconsistent(self)</code></p><p><span class="text.normal">Whether the stored configuration has the necessary</span><span class="text.line-break"> </span><span class="text.normal">on-disk structure for supporting a rootd Service.</span></p></section><section class="method" documented="true" local-identifier="load" id="Configuration.load"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.load"><span class="text.normal">load</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">load(self)</code></p><p><span class="text.normal">Load the service definition from the filesystem.</span></p></section><section class="method" documented="true" local-identifier="store" id="Configuration.store"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.store"><span class="text.normal">store</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">store(self)</code></p><p><span class="text.normal">Store the service definition to the filesystem.</span></p></section><section class="method" documented="false" local-identifier="load_abstract" id="Configuration.load_abstract"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.load_abstract"><span class="text.normal">load_abstract</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">load_abstract(self)</code></p></section><section class="method" documented="false" local-identifier="store_abstract" id="Configuration.store_abstract"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.store_abstract"><span class="text.normal">store_abstract</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">store_abstract(self)</code></p></section><section class="method" documented="false" local-identifier="load_invocation" id="Configuration.load_invocation"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.load_invocation"><span class="text.normal">load_invocation</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">load_invocation(self)</code></p></section><section class="method" documented="false" local-identifier="store_invocation" id="Configuration.store_invocation"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.store_invocation"><span class="text.normal">store_invocation</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">store_invocation(self)</code></p></section><section class="method" documented="false" local-identifier="load_actuation" id="Configuration.load_actuation"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.load_actuation"><span class="text.normal">load_actuation</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">load_actuation(self)</code></p></section><section class="method" documented="false" local-identifier="store_actuation" id="Configuration.store_actuation"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.store_actuation"><span class="text.normal">store_actuation</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">store_actuation(self)</code></p></section><section class="property" documented="false" local-identifier="actuates" id="Configuration.actuates"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.actuates"><span class="text.normal">actuates</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">property</span></div><code class="type"><a class="invalid" href="#bool"><span class="unknown">bool</span></a></code></h1><p><code class="signature">actuates(self, val)</code></p></section><section class="method" documented="false" local-identifier="load_pid" id="Configuration.load_pid"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.load_pid"><span class="text.normal">load_pid</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">load_pid(self)</code></p></section><section class="method" documented="false" local-identifier="store_pid" id="Configuration.store_pid"><h1><span class="prefix"></span><a class="section" href="#Configuration">Configuration</a><a class="title" href="#Configuration.store_pid"><span class="text.normal">store_pid</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">store_pid(self)</code></p></section></section><h1 class="footing"></h1></main></body></html>