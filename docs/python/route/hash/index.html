<html root="2"><head><title>fault.route.hash</title><meta charset="utf-8"/><link as="style" rel="preload" href="../../.legacy-web/core.css"></link><link as="style" rel="preload" href="../../.legacy-web/factor.css"></link><link rel="stylesheet" href="../../.legacy-web/core.css"></link><link rel="stylesheet" href="../../.legacy-web/factor.css"></link></head><body><main><h1><span class="prefix"></span><div class="page-subject"><img class="icon" src="../../.factor-type-icon/if.fault.io/python-module.svg"></img><span class="subject-identifier">hash</span><span class="element-status"><span class="nothing-missed">0</span></span><a href="http://if.fault.io/factors/python.module"><code class="type">python.module</code></a></div><div class="page-context"><a href="../"><img class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTYiIGhlaWdodD0iMjU2Ij48dGV4dCB4PSI0IiB5PSIwLjg4ZW0iIGZvbnQtc2l6ZT0iMjQ4Ij7wn5qPPC90ZXh0Pjwvc3ZnPg=="></img></a><span class="context-identifier">fault.route</span></div></h1><section class="chapter"><p><span class="text.normal">Hash path implementation for compressing file paths.</span></p></section><section class="import" documented="false" local-identifier="Sequence" id="Sequence"><h1><span class="prefix"></span><a class="title" href="#Sequence"><span class="text.normal">Sequence</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="Iterable" id="Iterable"><h1><span class="prefix"></span><a class="title" href="#Iterable"><span class="text.normal">Iterable</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="functools" id="functools"><h1><span class="prefix"></span><a class="title" href="#functools"><span class="text.normal">functools</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="class" documented="false" local-identifier="FNV" id="FNV"><h1><span class="prefix"></span><a class="title" href="#FNV"><span class="text.normal">FNV</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">class</span></div></h1><div class="inheritance"><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></div><section class="classmethod" documented="false" local-identifier="compute" id="FNV.compute"><h1><span class="prefix"></span><a class="section" href="#FNV">FNV</a><a class="title" href="#FNV.compute"><span class="text.normal">compute</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">classmethod</span></div></h1><p><code class="signature">compute(Class, data)</code></p></section><section class="method" documented="false" local-identifier="__init__" id="FNV.__init__"><h1><span class="prefix"></span><a class="section" href="#FNV">FNV</a><a class="title" href="#FNV.__init__"><span class="text.normal">__init__</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__init__(self)</code></p></section><section class="method" documented="false" local-identifier="update" id="FNV.update"><h1><span class="prefix"></span><a class="section" href="#FNV">FNV</a><a class="title" href="#FNV.update"><span class="text.normal">update</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">update(self, data)</code></p></section><section class="method" documented="false" local-identifier="hexdigest" id="FNV.hexdigest"><h1><span class="prefix"></span><a class="section" href="#FNV">FNV</a><a class="title" href="#FNV.hexdigest"><span class="text.normal">hexdigest</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div><code class="type"><a class="invalid" href="#str"><span class="unknown">str</span></a></code></h1><p><code class="signature">hexdigest(self)</code></p></section><section class="method" documented="false" local-identifier="digest" id="FNV.digest"><h1><span class="prefix"></span><a class="section" href="#FNV">FNV</a><a class="title" href="#FNV.digest"><span class="text.normal">digest</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div><code class="type"><a class="invalid" href="#int"><span class="unknown">int</span></a></code></h1><p><code class="signature">digest(self)</code></p></section></section><section class="class" documented="true" local-identifier="Segmentation" id="Segmentation"><h1><span class="prefix"></span><a class="title" href="#Segmentation"><span class="text.normal">Segmentation</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">class</span></div></h1><div class="inheritance"><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></div><p><span class="text.normal">Hash implementation container providing division logic for constructing</span><span class="text.line-break"> </span><span class="text.normal">the path segment to be used by a resource's key.</span></p><section class="method" documented="false" local-identifier="__init__" id="Segmentation.__init__"><h1><span class="prefix"></span><a class="section" href="#Segmentation">Segmentation</a><a class="title" href="#Segmentation.__init__"><span class="text.normal">__init__</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__init__(self, implementation, algorithm, depth, length)</code></p></section><section class="staticmethod" documented="true" local-identifier="divide" id="Segmentation.divide"><h1><span class="prefix"></span><a class="section" href="#Segmentation">Segmentation</a><a class="title" href="#Segmentation.divide"><span class="text.normal">divide</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">staticmethod</span></div><code class="type">Sequence[str]</code></h1><p><code class="signature">divide(digest, length, edge, step)</code></p><p><span class="text.normal">Split the hex digest into parts for building a Route to the bucket.</span></p></section><section class="method" documented="true" local-identifier="__call__" id="Segmentation.__call__"><h1><span class="prefix"></span><a class="section" href="#Segmentation">Segmentation</a><a class="title" href="#Segmentation.__call__"><span class="text.normal">__call__</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div><code class="type">Sequence[str]</code></h1><p><code class="signature">__call__(self, key)</code></p><p><span class="text.normal">Hash the given key with the configured algorithm returning the divided digest.</span></p></section><section class="method" documented="true" local-identifier="identity" id="Segmentation.identity"><h1><span class="prefix"></span><a class="section" href="#Segmentation">Segmentation</a><a class="title" href="#Segmentation.identity"><span class="text.normal">identity</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div><code class="type">tuple[str, int, int]</code></h1><p><code class="signature">identity(self)</code></p><p><span class="text.normal">Return a tuple consisting of the algorithm identifier, the number</span><span class="text.line-break"> </span><span class="text.normal">of divisions, and the character length of the hex digest.</span></p></section><section class="classmethod" documented="true" local-identifier="from_identity" id="Segmentation.from_identity"><h1><span class="prefix"></span><a class="section" href="#Segmentation">Segmentation</a><a class="title" href="#Segmentation.from_identity"><span class="text.normal">from_identity</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">classmethod</span></div></h1><p><code class="signature">from_identity(Class)</code></p><p><span class="text.normal">Create an instance using the identity.</span></p></section></section><section class="class" documented="true" local-identifier="Index" id="Index"><h1><span class="prefix"></span><a class="title" href="#Index"><span class="text.normal">Index</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">class</span></div></h1><div class="inheritance"><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></div><p><span class="text.normal">A bucket index for </span><a class="factor-local" href="#Directory"><span class="class">Directory</span></a><span class="text.normal"> resources.</span></p><p><span class="text.normal">Manages the sequence of entries for a bucket.</span></p><p><span class="text.normal">The index files are a series of entry identifiers followed</span><span class="text.line-break"> </span><span class="text.normal">by the key on a greater indentation level; the trailing newline</span><span class="text.line-break"> </span><span class="text.normal">of each indentation block not being part of the key.</span></p><section class="staticmethod" documented="true" local-identifier="structure" id="Index.structure"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.structure"><span class="text.normal">structure</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">staticmethod</span></div></h1><p><code class="signature">structure(seq)</code></p><p><span class="text.normal">Structure the indentation blocks into (key, entry) pairs.</span><span class="text.line-break"> </span><span class="text.normal">The keys are the indented section and the entries are the leading</span><span class="text.line-break"> </span><span class="text.normal">unindented identifier.</span></p><p><span class="text.normal">Trailing newlines </span><span class="text.emphasis">MUST</span><span class="text.normal"> be present.</span><span class="text.line-break"> </span><span class="text.normal">Structure presumes that the index file was loaded using readlines.</span></p><p><span class="text.normal">Entries (unindented areas) must be a single line followed by one</span><span class="text.line-break"> </span><span class="text.normal">or more indented lines. The initial indentation level (first tab)</span><span class="text.line-break"> </span><span class="text.normal">will be remove; the content will be considered to be the continuation</span><span class="text.line-break"> </span><span class="text.normal">of the key (that's hashed to select this bucket's index).</span></p><p><span class="text.normal">Underscore attributes are representations of stored data.</span></p></section><section class="classmethod" documented="false" local-identifier="from_path" id="Index.from_path"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.from_path"><span class="text.normal">from_path</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">classmethod</span></div></h1><p><code class="signature">from_path(Class, path)</code></p></section><section class="method" documented="false" local-identifier="__init__" id="Index.__init__"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.__init__"><span class="text.normal">__init__</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__init__(self)</code></p></section><section class="method" documented="true" local-identifier="load" id="Index.load"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.load"><span class="text.normal">load</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">load(self, lines)</code></p><p><span class="text.normal">Load the index from the given line sequence.</span><span class="text.line-break"> </span><a class="factor-local" href="#Index.load.Parameters.lines"><span class="parameter">lines</span></a><span class="text.normal"> items </span><span class="text.emphasis">must</span><span class="text.normal"> have trailing newlines.</span></p></section><section class="method" documented="true" local-identifier="sequence" id="Index.sequence"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.sequence"><span class="text.normal">sequence</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">sequence(self)</code></p><p><span class="text.normal">Send the serialized index state to the given </span><a class="invalid" href="#write"><span class="unknown">write</span></a><span class="text.normal"> function.</span></p></section><section class="method" documented="true" local-identifier="keys" id="Index.keys"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.keys"><span class="text.normal">keys</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">keys(self)</code></p><p><span class="text.normal">Iterator containing the keys loaded from the index.</span></p></section><section class="method" documented="false" local-identifier="items" id="Index.items"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.items"><span class="text.normal">items</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">items(self)</code></p></section><section class="method" documented="true" local-identifier="has_key" id="Index.has_key"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.has_key"><span class="text.normal">has_key</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">has_key(self, key)</code></p><p><span class="text.normal">Check if a key exists in the index.</span></p></section><section class="method" documented="false" local-identifier="__getitem__" id="Index.__getitem__"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.__getitem__"><span class="text.normal">__getitem__</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__getitem__(self, key)</code></p></section><section class="method" documented="false" local-identifier="__delitem__" id="Index.__delitem__"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.__delitem__"><span class="text.normal">__delitem__</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__delitem__(self, key)</code></p></section><section class="method" documented="true" local-identifier="allocate" id="Index.allocate"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.allocate"><span class="text.normal">allocate</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">allocate(self, keys, filename)</code></p><p><span class="text.normal">Allocate a sequence of entries for the given keys.</span></p></section><section class="method" documented="true" local-identifier="insert" id="Index.insert"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.insert"><span class="text.normal">insert</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">insert(self, key, filename)</code></p><p><span class="text.normal">Insert the key into the bucket. The key </span><span class="text.emphasis">must</span><span class="text.normal"> not already be present.</span></p></section><section class="method" documented="true" local-identifier="delete" id="Index.delete"><h1><span class="prefix"></span><a class="section" href="#Index">Index</a><a class="title" href="#Index.delete"><span class="text.normal">delete</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">delete(self, key)</code></p><p><span class="text.normal">Delete the key from the index returning the entry for removal.</span></p></section></section><section class="class" documented="true" local-identifier="Directory" id="Directory"><h1><span class="prefix"></span><a class="title" href="#Directory"><span class="text.normal">Directory</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">class</span></div></h1><div class="inheritance"><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></div><p><span class="text.normal">Filesystem based hash tree.</span></p><section class="unspecified" documented="true" local-identifier="Properties" id="Directory.Properties"><h1 class="integrate"><span class="prefix"></span><a class="section" href="#Directory">Directory</a><a class="title" href="#Directory.Properties"><span class="text.normal">Properties</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type"></span></div></h1><dl class="text.mapping"><div id="Directory.Properties.addressing" documented="true"><dt><a class="dkn" href="#Directory.Properties.addressing"></a><span class="directory-key"><span class="text.normal">addressing</span></span></dt><dd><div class="status"></div><p><span class="text.normal">The address resolution method. Usually a </span><a class="factor-local" href="#Segmentation"><span class="class">Segmentation</span></a><span class="text.normal"> instance.</span></p></dd></div><div id="Directory.Properties.path" documented="true"><dt><a class="dkn" href="#Directory.Properties.path"></a><span class="directory-key"><span class="text.normal">path</span></span></dt><dd><div class="status"></div><p><span class="text.normal">The route to the resource that contains the tree.</span></p></dd></div></dl></section><section class="data" documented="false" local-identifier="index_name" id="Directory.index_name"><h1><span class="prefix"></span><a class="section" href="#Directory">Directory</a><a class="title" href="#Directory.index_name"><span class="text.normal">index_name</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">index_name = '.index'
</code></pre></section><section class="method" documented="false" local-identifier="__init__" id="Directory.__init__"><h1><span class="prefix"></span><a class="section" href="#Directory">Directory</a><a class="title" href="#Directory.__init__"><span class="text.normal">__init__</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__init__(self, addressing, directory)</code></p></section><section class="method" documented="true" local-identifier="items" id="Directory.items"><h1><span class="prefix"></span><a class="section" href="#Directory">Directory</a><a class="title" href="#Directory.items"><span class="text.normal">items</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div><code class="type">Iterable[(bytes, object)]</code></h1><p><code class="signature">items(self)</code></p><p><span class="text.normal">Returns an iterator to all the keys and their associated routes.</span></p></section><section class="method" documented="false" local-identifier="_index" id="Directory._index"><h1><span class="prefix"></span><a class="section" href="#Directory">Directory</a><a class="title" href="#Directory._index"><span class="text.normal">_index</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">_index(self, route)</code></p></section><section class="method" documented="true" local-identifier="allocate" id="Directory.allocate"><h1><span class="prefix"></span><a class="section" href="#Directory">Directory</a><a class="title" href="#Directory.allocate"><span class="text.normal">allocate</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></h1><p><code class="signature">allocate(self, key)</code></p><p><span class="text.normal">Allocate a position for the given </span><a class="factor-local" href="#Directory.allocate.Parameters.key"><span class="parameter">key</span></a><span class="text.normal"> and return its route.</span></p><p><span class="text.normal">If already allocated, return the reference to the resource.</span></p></section><section class="method" documented="true" local-identifier="available" id="Directory.available"><h1><span class="prefix"></span><a class="section" href="#Directory">Directory</a><a class="title" href="#Directory.available"><span class="text.normal">available</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div><code class="type"><a class="invalid" href="#bool"><span class="unknown">bool</span></a></code></h1><p><code class="signature">available(self, key)</code></p><p><span class="text.normal">Whether the resource has not been allocated.</span></p><p><a class="invalid" href="#True"><span class="unknown">True</span></a><span class="text.normal"> when </span><a class="factor-local" href="#Directory.available.Parameters.key"><span class="parameter">key</span></a><span class="text.normal"> has </span><span class="text.emphasis">not</span><span class="text.normal"> been associated with a resource.</span></p></section><section class="method" documented="true" local-identifier="release" id="Directory.release"><h1><span class="prefix"></span><a class="section" href="#Directory">Directory</a><a class="title" href="#Directory.release"><span class="text.normal">release</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">release(self, key)</code></p><p><span class="text.normal">Release the allocated resource associated with the </span><a class="factor-local" href="#Directory.release.Parameters.key"><span class="parameter">key</span></a><span class="text.normal"> and delete it from the index.</span></p></section></section><h1 class="footing"></h1></main></body></html>