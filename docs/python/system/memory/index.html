<html root="2"><head><title>fault.system.memory</title><meta charset="utf-8"/><link as="style" rel="preload" href="../../.legacy-web/core.css"></link><link as="style" rel="preload" href="../../.legacy-web/factor.css"></link><link rel="stylesheet" href="../../.legacy-web/core.css"></link><link rel="stylesheet" href="../../.legacy-web/factor.css"></link></head><body><main><h1><span class="prefix"></span><div class="page-subject"><img class="icon" src="../../.factor-type-icon/if.fault.io/python-module.svg"></img><span class="subject-identifier">memory</span><span class="element-status"><span class="misses">35</span><span class="completion-isolation"></span><span class="completion">57%</span></span><a href="http://if.fault.io/factors/python.module"><code class="type">python.module</code></a></div><div class="page-context"><a href="../"><img class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTYiIGhlaWdodD0iMjU2Ij48dGV4dCB4PSI0IiB5PSIwLjg4ZW0iIGZvbnQtc2l6ZT0iMjQ4Ij7impnvuI88L3RleHQ+PC9zdmc+"></img></a><span class="context-identifier">fault.system</span></div></h1><section class="chapter"><p><span class="text.normal">Memory management classes for implementing usage constraints</span><span class="text.line-break"> </span><span class="text.normal">in parts of processes.</span></p></section><section class="import" documented="false" local-identifier="os" id="os"><h1><span class="prefix"></span><a class="title" href="#os"><span class="text.normal">os</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="weakref" id="weakref"><h1><span class="prefix"></span><a class="title" href="#weakref"><span class="text.normal">weakref</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="collections" id="collections"><h1><span class="prefix"></span><a class="title" href="#collections"><span class="text.normal">collections</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="class" documented="true" local-identifier="Memory" id="Memory"><h1><span class="prefix"></span><a class="title" href="#Memory"><span class="text.normal">Memory</span></a><span class="element-status"><span class="misses">2</span><span class="completion-isolation"></span><span class="completion">71%</span></span><div class="factor-element-meta"><span class="abstract-type">class</span></div></h1><div class="inheritance"><code class="type"><a class="invalid" href="#bytearray"><span class="unknown">bytearray</span></a></code></div><p><span class="text.normal">bytearray subclass supporting weak-references and</span><span class="text.line-break"> </span><span class="text.normal">identifier hashing for memory-free signalling.</span></p><section class="data" documented="false" local-identifier="__slots__" id="Memory.__slots__"><h1><span class="prefix"></span><a class="section" href="#Memory">Memory</a><a class="title" href="#Memory.__slots__"><span class="text.normal">__slots__</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">__slots__ = ('__weakref__',)
</code></pre></section><section class="method" documented="true" local-identifier="__hash__" id="Memory.__hash__"><h1><span class="prefix"></span><a class="section" href="#Memory">Memory</a><a class="title" href="#Memory.__hash__"><span class="text.normal">__hash__</span></a><span class="element-status"><span class="misses">2</span><span class="completion-isolation"></span><span class="completion">0%</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__hash__(self)</code></p><p><span class="text.normal">Object Identifier based hash for allowing indexing of allocated instances.</span></p></section></section><section class="class" documented="true" local-identifier="MemoryContext" id="MemoryContext"><h1><span class="prefix"></span><a class="title" href="#MemoryContext"><span class="text.normal">MemoryContext</span></a><span class="element-status"><span class="misses">4</span><span class="completion-isolation"></span><span class="completion">42%</span></span><div class="factor-element-meta"><span class="abstract-type">class</span></div></h1><div class="inheritance"><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></div><p><span class="text.normal">Memory pool that uses weakref's and context managers to reclaim memory.</span></p><section class="data" documented="false" local-identifier="Memory" id="MemoryContext.Memory"><h1><span class="prefix"></span><a class="section" href="#MemoryContext">MemoryContext</a><a class="title" href="#MemoryContext.Memory"><span class="text.normal">Memory</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">Memory = Memory # bytearray subclass with weakref support
</code></pre></section><section class="data" documented="false" local-identifier="Reference" id="MemoryContext.Reference"><h1><span class="prefix"></span><a class="section" href="#MemoryContext">MemoryContext</a><a class="title" href="#MemoryContext.Reference"><span class="text.normal">Reference</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">data</span></div></h1><pre class="text.syntax"><code class="source">Reference = weakref.ref # for reclaiming memory
	@classmethod
</code></pre></section><section class="classmethod" documented="true" local-identifier="from_mib" id="MemoryContext.from_mib"><h1><span class="prefix"></span><a class="section" href="#MemoryContext">MemoryContext</a><a class="title" href="#MemoryContext.from_mib"><span class="text.normal">from_mib</span></a><span class="element-status"><span class="misses">4</span><span class="completion-isolation"></span><span class="completion">0%</span></span><div class="factor-element-meta"><span class="abstract-type">classmethod</span></div></h1><p><code class="signature">from_mib(typ, size)</code></p><p><span class="text.normal">Construct a Reservoir from the given number of Mebibytes desired.</span></p></section><section class="method" documented="false" local-identifier="__init__" id="MemoryContext.__init__"><h1><span class="prefix"></span><a class="section" href="#MemoryContext">MemoryContext</a><a class="title" href="#MemoryContext.__init__"><span class="text.normal">__init__</span></a><span class="element-status"><span class="misses">7</span><span class="completion-isolation"></span><span class="completion">0%</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__init__(self)</code></p></section><section class="property" documented="true" local-identifier="used" id="MemoryContext.used"><h1><span class="prefix"></span><a class="section" href="#MemoryContext">MemoryContext</a><a class="title" href="#MemoryContext.used"><span class="text.normal">used</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">property</span></div></h1><p><span class="text.normal">Memory units currently in use.</span></p></section><section class="property" documented="true" local-identifier="available" id="MemoryContext.available"><h1><span class="prefix"></span><a class="section" href="#MemoryContext">MemoryContext</a><a class="title" href="#MemoryContext.available"><span class="text.normal">available</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">property</span></div></h1><p><span class="text.normal">Number of memory units available.</span></p></section><section class="method" documented="true" local-identifier="allocate" id="MemoryContext.allocate"><h1><span class="prefix"></span><a class="section" href="#MemoryContext">MemoryContext</a><a class="title" href="#MemoryContext.allocate"><span class="text.normal">allocate</span></a><span class="element-status"><span class="misses">6</span><span class="completion-isolation"></span><span class="completion">0%</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">allocate(self)</code></p><p><span class="text.normal">Allocate a unit of memory for use. When Python references to the memory object</span><span class="text.line-break"> </span><span class="text.normal">no longer exist, another unit will be added.</span></p></section><section class="method" documented="false" local-identifier="reclaim" id="MemoryContext.reclaim"><h1><span class="prefix"></span><a class="section" href="#MemoryContext">MemoryContext</a><a class="title" href="#MemoryContext.reclaim"><span class="text.normal">reclaim</span></a><span class="element-status"><span class="misses">4</span><span class="completion-isolation"></span><span class="completion">0%</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">reclaim(self, memory)</code></p></section><section class="method" documented="true" local-identifier="acquire" id="MemoryContext.acquire"><h1><span class="prefix"></span><a class="section" href="#MemoryContext">MemoryContext</a><a class="title" href="#MemoryContext.acquire"><span class="text.normal">acquire</span></a><span class="element-status"><span class="misses">2</span><span class="completion-isolation"></span><span class="completion">0%</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">acquire(self, event)</code></p><p><span class="text.normal">Explicitly add an object to the available segments.</span></p></section></section><section class="class" documented="true" local-identifier="Segments" id="Segments"><h1><span class="prefix"></span><a class="title" href="#Segments"><span class="text.normal">Segments</span></a><span class="element-status"><span class="nothing-missed">0</span></span><div class="factor-element-meta"><span class="abstract-type">class</span></div></h1><div class="inheritance"><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></div><p><span class="text.normal">Iterate over the slices of an active memory map;</span><span class="text.line-break"> </span><span class="text.normal">Weak references of the slices are held to track when</span><span class="text.line-break"> </span><span class="text.normal">its appropriate to close the memory map.</span></p><section class="import" documented="false" local-identifier="MemoryMap" id="Segments.MemoryMap"><h1><span class="prefix"></span><a class="section" href="#Segments">Segments</a><a class="title" href="#Segments.MemoryMap"><span class="text.normal">MemoryMap</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="import" documented="false" local-identifier="ACCESS_MODE" id="Segments.ACCESS_MODE"><h1><span class="prefix"></span><a class="section" href="#Segments">Segments</a><a class="title" href="#Segments.ACCESS_MODE"><span class="text.normal">ACCESS_MODE</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type">import</span></div></h1></section><section class="classmethod" documented="true" local-identifier="open" id="Segments.open"><h1><span class="prefix"></span><a class="section" href="#Segments">Segments</a><a class="title" href="#Segments.open"><span class="text.normal">open</span></a><span class="element-status"><span class="nothing-missed">0</span></span><div class="factor-element-meta"><span class="abstract-type">classmethod</span></div></h1><p><code class="signature">open(Class, path)</code></p><p><span class="text.normal">Open the file at the given path in read-only mode and</span><span class="text.line-break"> </span><span class="text.normal">create a </span><a class="factor-local" href="#Segments"><span class="class">Segments</span></a><span class="text.normal"> providing a </span><a class="none" href="http://fault.io/dev/null"><span class="invalid">mmap.mmap</span></a><span class="text.normal"> interface</span><span class="text.line-break"> </span><span class="text.normal">to the contents.</span></p></section><section class="method" documented="true" local-identifier="__init__" id="Segments.__init__"><h1><span class="prefix"></span><a class="section" href="#Segments">Segments</a><a class="title" href="#Segments.__init__"><span class="text.normal">__init__</span></a><span class="element-status"><span class="nothing-missed">0</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__init__(self, memory)</code></p><p><span class="text.normal">Initialize an instance using the given </span><a class="factor-local" href="#Segments.__init__.Parameters.memory"><span class="parameter">memory</span></a><span class="text.normal">. An instance</span><span class="text.line-break"> </span><span class="text.normal">created by </span><a class="none" href="http://fault.io/dev/null"><span class="invalid">mmap.mmap</span></a><span class="text.normal">.</span></p><section class="unspecified" documented="true" local-identifier="Parameters" id="Segments.__init__.Parameters"><h1 class="integrate"><span class="prefix"></span><a class="section" href="#Segments">Segments</a><a class="section" href="#Segments.__init__">__init__</a><a class="title" href="#Segments.__init__.Parameters"><span class="text.normal">Parameters</span></a><span class="element-status"></span><div class="factor-element-meta"><span class="abstract-type"></span></div></h1><dl class="text.mapping"><div id="Segments.__init__.Parameters.self" class="parameter" documented="false"><dt><a class="dkn" href="#Segments.__init__.Parameters.self"></a><span class="directory-key"><code class="parameter">self</code></span></dt><dd><div class="status"></div><p><code class="control.absent">Undocumented</code><span class="text.normal">.</span></p></dd></div><div id="Segments.__init__.Parameters.memory" class="parameter" documented="true"><dt><a class="dkn" href="#Segments.__init__.Parameters.memory"></a><span class="directory-key"><code class="parameter">memory</code></span></dt><dd><div class="status"></div><ul class="text.set"><li><p><code class="type.syntax">MemoryMap</code></p></li><li><p><a class="type" href="http://fault.io/dev/null"><span class="none">mmap.mmap</span></a></p></li></ul><p><span class="text.normal">The </span><code class="">mmap.mmap</code><span class="text.normal"> instance defining the total memory region.</span></p></dd></div></dl></section></section><section class="method" documented="true" local-identifier="__del__" id="Segments.__del__"><h1><span class="prefix"></span><a class="section" href="#Segments">Segments</a><a class="title" href="#Segments.__del__"><span class="text.normal">__del__</span></a><span class="element-status"><span class="misses">1</span><span class="completion-isolation"></span><span class="completion">88%</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__del__(self)</code></p><p><span class="text.normal">Manage the final stages of </span><a class="factor-local" href="#Segments"><span class="class">Segments</span></a><span class="text.normal"> deallocation by transitioning</span><span class="text.line-break"> </span><span class="text.normal">to a finalization process where </span><a class="factor-local" href="#Segments.select"><span class="method">select</span></a><span class="text.normal"> methods can no longer occur,</span><span class="text.line-break"> </span><span class="text.normal">and existing </span><a class="invalid" href="#memoryview's"><span class="unknown">memoryview's</span></a><span class="text.normal"> referencing </span><a class="factor-local" href="#Segments.__del__.Parameters.self"><span class="parameter">self</span></a><span class="text.normal">, </span><a class="invalid" href="#weaks"><span class="unknown">weaks</span></a><span class="text.normal">, are</span><span class="text.line-break"> </span><span class="text.normal">used to construct a sequence of </span><a class="none" href="http://fault.io/dev/null"><span class="invalid">weakref.finalize</span></a><span class="text.normal"> callbacks.</span></p><p><span class="text.normal">Once in the final stage, a count of outstanding </span><a class="invalid" href="#memoryview"><span class="unknown">memoryview</span></a><span class="text.normal"> instances</span><span class="text.line-break"> </span><span class="text.normal">is tracked and decremented with </span><a class="factor-local" href="#Segments.decrement"><span class="method">decrement</span></a><span class="text.normal"> until there are no more references</span><span class="text.line-break"> </span><span class="text.normal">to the </span><a class="factor-local" href="#Segments"><span class="class">Segments</span></a><span class="text.normal"> allowing the file descriptor associated with </span><a class="invalid" href="#memory"><span class="unknown">memory</span></a><span class="text.normal"> to be closed.</span></p></section><section class="method" documented="true" local-identifier="decrement" id="Segments.decrement"><h1><span class="prefix"></span><a class="section" href="#Segments">Segments</a><a class="title" href="#Segments.decrement"><span class="text.normal">decrement</span></a><span class="element-status"><span class="nothing-missed">0</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">decrement(self)</code></p><p><span class="text.normal">Used internally by </span><a class="factor-local" href="#Segments.__del__"><span class="method">__del__</span></a><span class="text.normal"> to manage the deallocation process</span><span class="text.line-break"> </span><span class="text.normal">when there are outstanding references to the memory mapped region.</span></p></section><section class="method" documented="true" local-identifier="select" id="Segments.select"><h1><span class="prefix"></span><a class="section" href="#Segments">Segments</a><a class="title" href="#Segments.select"><span class="text.normal">select</span></a><span class="element-status"><span class="misses">1</span><span class="completion-isolation"></span><span class="completion">92%</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">select(self, start, stop, size)</code></p><p><span class="text.normal">Constructs an iterator to the parameterized range over the</span><span class="text.line-break"> </span><a class="invalid" href="#memory"><span class="unknown">memory</span></a><span class="text.normal"> the </span><a class="factor-local" href="#Segments"><span class="class">Segments</span></a><span class="text.normal"> instance was initialized with.</span></p></section><section class="method" documented="true" local-identifier="__iter__" id="Segments.__iter__"><h1><span class="prefix"></span><a class="section" href="#Segments">Segments</a><a class="title" href="#Segments.__iter__"><span class="text.normal">__iter__</span></a><span class="element-status"><span class="misses">1</span><span class="completion-isolation"></span><span class="completion">0%</span></span><div class="factor-element-meta"><span class="abstract-type">method</span></div></h1><p><code class="signature">__iter__(self)</code></p><p><span class="text.normal">Return an iterator to the entire region in sixteen kilobyte sizes.</span></p></section></section><h1 class="footing"></h1></main></body></html>