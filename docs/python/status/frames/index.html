<html root="2"><head><title>fault.status.frames</title><meta charset="utf-8"/><link as="style" rel="preload" href="../../.legacy-web/core.css"></link><link as="style" rel="preload" href="../../.legacy-web/factor.css"></link><link rel="stylesheet" href="../../.legacy-web/core.css"></link><link rel="stylesheet" href="../../.legacy-web/factor.css"></link></head><body><main><h1><span class="prefix"></span><div class="page-subject"><img class="icon" src="../../.factor-type-icon/if.fault.io/python-module.svg"></img><span class="subject-identifier">frames</span><a href="http://if.fault.io/factors/python.module"><code class="type">python.module</code></a></div><div class="page-context"><a href="../"><img class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTYiIGhlaWdodD0iMjU2Ij48dGV4dCB4PSI0IiB5PSIwLjg4ZW0iIGZvbnQtc2l6ZT0iMjQ4Ij7imabvuI88L3RleHQ+PC9zdmc+"></img></a><span class="context-identifier">fault.status</span></div></h1><section class="chapter"><p><span class="text.normal">Formatting and parsing tools for status frame transport envelopes.</span></p><p><span class="text.normal">This module provides conceptual definitions for Status Frame events (</span><a class="project-local" href="../types#EStruct"><span class="factor-element">fault.status.types.EStruct</span></a><span class="text.normal">) and</span><span class="text.line-break"> </span><span class="text.normal">I/O operations supporting the transmission of those events.</span></p><p><span class="text.normal">Status Frames are </span><a class="project-local" href="../types#Frame"><span class="factor-element">fault.status.types.Frame</span></a><span class="text.normal"> instances that can be serialized into and parsed from a data stream.</span></p></section><section class="unspecified" documented="true" local-identifier="Usage" id="Usage"><h1><span class="prefix"></span><a class="title" href="#Usage"><span class="text.normal">Usage</span></a><span class="abstract-type"></span></h1><p><span class="text.normal">The operation used to serialize and load the data extension is decoupled, so an allocation</span><span class="text.line-break"> </span><span class="text.normal">function is provided to apply the defaults for the data extension transport:</span></p><pre class="text.syntax"><code class="syntax/python">from fault.status import frames
</code></pre><p><span class="text.normal">Frame envelopes may or may not have content (data extensions):</span></p><pre class="text.syntax"><code class="syntax/python">msg = compose('!#', "ERROR: no such resource")
sys.stdout.write(frames.sequence(msg))

"[!# ERROR: no such resource]
</code></pre><p><span class="text.normal">"</span></p><p><span class="text.normal">Serialized messages are expected to include the trailing newline:</span></p><pre class="text.syntax"><code class="syntax/python">for line in sys.stdin.readlines():
	msg = frames.structure(line)
</code></pre></section><section class="unspecified" documented="true" local-identifier="Properties" id="Properties"><h1><span class="prefix"></span><a class="title" href="#Properties"><span class="text.normal">Properties</span></a><span class="abstract-type"></span></h1><dl class="text.mapping"><div id="Properties.protocol" documented="true"><dt><a class="dkn" href="#Properties.protocol"></a><span class="directory-key"><span class="text.normal">protocol</span></span></dt><dd><div class="status"></div><p><span class="text.normal">String identifying the status frames protocols.</span></p></dd></div><div id="Properties.ttyn1_minimum_overhead" documented="true"><dt><a class="dkn" href="#Properties.ttyn1_minimum_overhead"></a><span class="directory-key"><span class="text.normal">ttyn1_minimum_overhead</span></span></dt><dd><div class="status"></div><p><span class="text.normal">Informative minimum size regarding tty-notation-1 status frames.</span></p></dd></div></dl></section><section class="import" documented="false" local-identifier="typing" id="typing"><h1><span class="prefix"></span><a class="title" href="#typing"><span class="text.normal">typing</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="functools" id="functools"><h1><span class="prefix"></span><a class="title" href="#functools"><span class="text.normal">functools</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="base64" id="base64"><h1><span class="prefix"></span><a class="title" href="#base64"><span class="text.normal">base64</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="zlib" id="zlib"><h1><span class="prefix"></span><a class="title" href="#zlib"><span class="text.normal">zlib</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="transport" id="transport"><h1><span class="prefix"></span><a class="title" href="#transport"><span class="text.normal">transport</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="types" id="types"><h1><span class="prefix"></span><a class="title" href="#types"><span class="text.normal">types</span></a><span class="abstract-type">import</span></h1></section><section class="data" documented="false" local-identifier="protocol" id="protocol"><h1><span class="prefix"></span><a class="title" href="#protocol"><span class="text.normal">protocol</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">protocol = 'http://if.fault.io/status/frames'
</code></pre><pre class="text.syntax"><code class="source">protocol = "http://if.fault.io/status/frames"
</code></pre></section><section class="function" documented="true" local-identifier="compose" id="compose"><h1><span class="prefix"></span><a class="title" href="#compose"><span class="text.normal">compose</span></a><span class="abstract-type">function</span><code class="type"><a class="project-local" href="../types#Frame"><span class="factor-element">types.Frame</span></a></code></h1><p><code class="signature">compose(ftype, synopsis)</code></p><p><span class="text.normal">Create a status frame using the envelope's symbol and synopsis.</span></p></section><section class="function" documented="false" local-identifier="_frame_pack_extension" id="_frame_pack_extension"><h1><span class="prefix"></span><a class="title" href="#_frame_pack_extension"><span class="text.normal">_frame_pack_extension</span></a><span class="abstract-type">function</span><code class="type"><a class="invalid" href="#bytes"><span class="unknown">bytes</span></a></code></h1><p><code class="signature">_frame_pack_extension(data)</code></p></section><section class="function" documented="false" local-identifier="_frame_unpack_extension" id="_frame_unpack_extension"><h1><span class="prefix"></span><a class="title" href="#_frame_unpack_extension"><span class="text.normal">_frame_unpack_extension</span></a><span class="abstract-type">function</span><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></h1><p><code class="signature">_frame_unpack_extension(data)</code></p></section><section class="data" documented="false" local-identifier="type_codes" id="type_codes"><h1><span class="prefix"></span><a class="title" href="#type_codes"><span class="text.normal">type_codes</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">type_codes = {
	# [!? PROTOCOL: http://if.fault.io/status/frames tty-notation-1 base64/deflate]
	"!?": 'message-protocol',
	"!&#38;": 'reference',

	# Abstract Transaction progress.
	"&#62;&#60;": 'transaction-failed',
	"&#60;&#62;": 'transaction-executed',
	"-&#62;": 'transaction-started',
	"--": 'transaction-event',
	"&#60;-": 'transaction-stopped',

	# Warnings, Errors, and Information with respect to some conceptual level of a frame source.
	"!#": 'message-application',
	"!*": 'message-framework',
	"!~": 'message-trace',

	# Messages sent by user entities.
	"!%": 'message-administrative',
	"!&#62;": 'message-entity',

	# Resource Content Manipulation
	"+=": 'resource-inserted-units', # append
	"-=": 'resource-deleted-units', # partial truncation

	# SCM Operation Reports
	"Δ=": 'resource-delta',
	"&#60;=": 'resource-reverted',
	"==": 'resource-committed',

	# Resource Container Manipulations
	"+.": 'resource-initialized',
	"%.": 'resource-truncated',
	"-.": 'resource-deleted',

	"*.": 'resource-replicated',
	"&#38;.": 'resource-referenced',
	"..": 'resource-relocated',
	"Δ@": 'resource-property-delta',

	"&#62;|": 'resource-rewritten',
	".|": 'resource-relocated-substitution',
	"*|": 'resource-replicated-substitution',
	"&#38;|": 'resource-referenced-substitution',

	"*&#38;": 'resource-hardlinked',
	"*+": 'resource-replicated-merge',

	# Archive I/O
	"^*": 'archive-extraction-replicated',
	"^|": 'archive-extraction-replicated-substitution',
	"^+": 'archive-extraction-replicated-merge',

	"√*": 'archive-delta-replicated-into',
	"√|": 'archive-delta-replicated-substitution-into',
	"√+": 'archive-delta-merged-into',
	"√-": 'archive-delta-deleted',
	"√&#38;": 'archive-delta-referenced',

	# Transfer Snapshots.
	"↑.": 'resource-transmitted',
	"↓.": 'resource-received',
	"↑|": 'resource-transmitted-substitution',
	"↓|": 'resource-received-substitution',

	# Transfer Progress Information.
	"↑:": 'data-transmitted',
	"↓:": 'data-received',
	"↓↑": 'data-transferred',
}

@functools.lru_cache(16)
</code></pre></section><section class="function" documented="true" local-identifier="type_integer_code" id="type_integer_code"><h1><span class="prefix"></span><a class="title" href="#type_integer_code"><span class="text.normal">type_integer_code</span></a><span class="abstract-type">function</span><code class="type"><a class="invalid" href="#int"><span class="unknown">int</span></a></code></h1><p><code class="signature">type_integer_code(typstring)</code></p><p><span class="text.normal">Convert a two-character type code symbol into an unsigned 32-bit integer.</span><span class="text.line-break"> </span><span class="text.normal">Currently, only supporting unicode characters in the 16-bit range.</span></p></section><section class="function" documented="true" local-identifier="type_identifier_string" id="type_identifier_string"><h1><span class="prefix"></span><a class="title" href="#type_identifier_string"><span class="text.normal">type_identifier_string</span></a><span class="abstract-type">function</span><code class="type"><a class="invalid" href="#str"><span class="unknown">str</span></a></code></h1><p><code class="signature">type_identifier_string(typcode)</code></p><p><span class="text.normal">Convert an integer type code into the two-character string used for serialization and display.</span></p></section><section class="data" documented="false" local-identifier="_tty_open_extension" id="_tty_open_extension"><h1><span class="prefix"></span><a class="title" href="#_tty_open_extension"><span class="text.normal">_tty_open_extension</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">_tty_open_extension = "\x1b]8;1;2-x"
</code></pre></section><section class="data" documented="false" local-identifier="_tty_exit_extension" id="_tty_exit_extension"><h1><span class="prefix"></span><a class="title" href="#_tty_exit_extension"><span class="text.normal">_tty_exit_extension</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">_tty_exit_extension = "\x03\x1b\\"
</code></pre></section><section class="data" documented="false" local-identifier="_tty_extension_signal" id="_tty_extension_signal"><h1><span class="prefix"></span><a class="title" href="#_tty_extension_signal"><span class="text.normal">_tty_extension_signal</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">_tty_extension_signal = ("\x1b[32;2m", "\x1b[39;22m") # Green.
</code></pre></section><section class="data" documented="false" local-identifier="ttyn1_minimum_overhead" id="ttyn1_minimum_overhead"><h1><span class="prefix"></span><a class="title" href="#ttyn1_minimum_overhead"><span class="text.normal">ttyn1_minimum_overhead</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ttyn1_minimum_overhead = \
	len(_tty_open_extension) + \
	len(_tty_exit_extension) + \
	len("[-- ]\n")
</code></pre></section><section class="data" documented="false" local-identifier="_frame_open" id="_frame_open"><h1><span class="prefix"></span><a class="title" href="#_frame_open"><span class="text.normal">_frame_open</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">_frame_open = "[{ts} "
</code></pre></section><section class="data" documented="false" local-identifier="_frame_exit" id="_frame_exit"><h1><span class="prefix"></span><a class="title" href="#_frame_exit"><span class="text.normal">_frame_exit</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">_frame_exit = "]\n"
</code></pre></section><section class="data" documented="false" local-identifier="_loaded_frame_start" id="_loaded_frame_start"><h1><span class="prefix"></span><a class="title" href="#_loaded_frame_start"><span class="text.normal">_loaded_frame_start</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">_loaded_frame_start = _frame_open + "{image}"
</code></pre></section><section class="data" documented="false" local-identifier="_loaded_frame_partition" id="_loaded_frame_partition"><h1><span class="prefix"></span><a class="title" href="#_loaded_frame_partition"><span class="text.normal">_loaded_frame_partition</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">_loaded_frame_partition = " ({channel}{wrap[0]}{signal}{size}{wrap[1]}{hidden}"
</code></pre></section><section class="data" documented="false" local-identifier="_loaded_frame_stop" id="_loaded_frame_stop"><h1><span class="prefix"></span><a class="title" href="#_loaded_frame_stop"><span class="text.normal">_loaded_frame_stop</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">_loaded_frame_stop = "{reveal})]\n"
</code></pre></section><section class="data" documented="false" local-identifier="_empty_frame_stop" id="_empty_frame_stop"><h1><span class="prefix"></span><a class="title" href="#_empty_frame_stop"><span class="text.normal">_empty_frame_stop</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">_empty_frame_stop = "{hidden}{reveal}]\n"
</code></pre></section><section class="function" documented="true" local-identifier="_pack" id="_pack"><h1><span class="prefix"></span><a class="title" href="#_pack"><span class="text.normal">_pack</span></a><span class="abstract-type">function</span><code class="type">typing.Tuple[str, bytes, str]</code></h1><p><code class="signature">_pack(frame)</code></p><p><span class="text.normal">Pack a status frame for transmission.</span></p><p><span class="text.normal">Constructs a triple containing the leading envelope string,</span><span class="text.line-break"> </span><span class="text.normal">the encoded bytes of data extending the frame and the terminating trailer.</span></p></section><section class="function" documented="true" local-identifier="sequence" id="sequence"><h1><span class="prefix"></span><a class="title" href="#sequence"><span class="text.normal">sequence</span></a><span class="abstract-type">function</span><code class="type"><a class="invalid" href="#str"><span class="unknown">str</span></a></code></h1><p><code class="signature">sequence(frame)</code></p><p><span class="text.normal">Pack a status frame into a </span><a class="invalid" href="#str"><span class="unknown">str</span></a><span class="text.normal"> for transmission.</span></p><p><span class="text.normal">Constructs a single </span><a class="invalid" href="#str"><span class="unknown">str</span></a><span class="text.normal"> instance.</span></p><section class="unspecified" documented="true" local-identifier="Parameters" id="sequence.Parameters"><h1 class="integrate"><span class="prefix"></span><a class="section" href="#sequence">sequence</a><a class="title" href="#sequence.Parameters"><span class="text.normal">Parameters</span></a><span class="abstract-type"></span></h1><dl class="text.mapping"><div id="sequence.Parameters.frame" class="parameter" documented="true"><dt><a class="dkn" href="#sequence.Parameters.frame"></a><span class="directory-key"><code class="parameter">frame</code></span></dt><dd><div class="status"></div><ul class="text.set"><li><p><code class="type.syntax">types.Frame</code></p></li><li><p><a class="type" href="types#Frame"><span class="project-local">fault.status.types.Frame</span></a></p></li></ul><p><span class="text.normal">The status frame to be represented in serial form.</span></p></dd></div><div id="sequence.Parameters.channel" class="parameter" documented="false"><dt><a class="dkn" href="#sequence.Parameters.channel"></a><span class="directory-key"><code class="parameter">channel</code></span></dt><dd><div class="status"></div><p><code class="control.absent">Undocumented</code><span class="text.normal">.</span></p></dd></div></dl></section></section><section class="function" documented="true" local-identifier="_unpack" id="_unpack"><h1><span class="prefix"></span><a class="title" href="#_unpack"><span class="text.normal">_unpack</span></a><span class="abstract-type">function</span><code class="type"><a class="project-local" href="../types#Frame"><span class="factor-element">types.Frame</span></a></code></h1><p><code class="signature">_unpack(line, offset, limit)</code></p><p><span class="text.normal">Unpack a serialized status frame.</span></p></section><section class="function" documented="true" local-identifier="structure" id="structure"><h1><span class="prefix"></span><a class="title" href="#structure"><span class="text.normal">structure</span></a><span class="abstract-type">function</span><code class="type"><a class="project-local" href="../types#Frame"><span class="factor-element">types.Frame</span></a></code></h1><p><code class="signature">structure(line)</code></p><p><span class="text.normal">Extract a status frame, </span><a class="project-local" href="../types#Frame"><span class="factor-element">fault.status.types.Frame</span></a><span class="text.normal">, from the given </span><a class="factor-local" href="#structure.Parameters.line"><span class="parameter">line</span></a><span class="text.normal">.</span></p><section class="unspecified" documented="true" local-identifier="Parameters" id="structure.Parameters"><h1 class="integrate"><span class="prefix"></span><a class="section" href="#structure">structure</a><a class="title" href="#structure.Parameters"><span class="text.normal">Parameters</span></a><span class="abstract-type"></span></h1><dl class="text.mapping"><div id="structure.Parameters.line" class="parameter" documented="true"><dt><a class="dkn" href="#structure.Parameters.line"></a><span class="directory-key"><code class="parameter">line</code></span></dt><dd><div class="status"></div><ul class="text.set"><li><p><code class="type.syntax">str</code></p></li><li><p><a class="type" href="#str"><span class="invalid">str</span></a></p></li></ul><p><span class="text.normal">A single serialized line.</span></p></dd></div></dl></section></section><section class="function" documented="true" local-identifier="declaration" id="declaration"><h1><span class="prefix"></span><a class="title" href="#declaration"><span class="text.normal">declaration</span></a><span class="abstract-type">function</span></h1><p><code class="signature">declaration()</code></p><p><span class="text.normal">Construct a custom protocol declaration message.</span></p></section><section class="data" documented="false" local-identifier="tty_notation_1_message" id="tty_notation_1_message"><h1><span class="prefix"></span><a class="title" href="#tty_notation_1_message"><span class="text.normal">tty_notation_1_message</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">tty_notation_1_message = declaration()
</code></pre></section><section class="data" documented="false" local-identifier="tty_notation_1_string" id="tty_notation_1_string"><h1><span class="prefix"></span><a class="title" href="#tty_notation_1_string"><span class="text.normal">tty_notation_1_string</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">tty_notation_1_string = "[!? " + tty_notation_1_message.f_event.abstract + "]\n"
</code></pre></section><section class="function" documented="true" local-identifier="message_directed_areas" id="message_directed_areas"><h1><span class="prefix"></span><a class="title" href="#message_directed_areas"><span class="text.normal">message_directed_areas</span></a><span class="abstract-type">function</span></h1><p><code class="signature">message_directed_areas(fields, start, end)</code></p><p><span class="text.normal">Return the slices marking the areas before and after the first item</span><span class="text.line-break"> </span><span class="text.normal">contained in </span><a class="factor-local" href="#message_directed_areas.Parameters.arrows"><span class="parameter">arrows</span></a><span class="text.normal">.</span></p><p><a class="invalid" href="#None"><span class="unknown">None</span></a><span class="text.normal"> if no items in </span><a class="factor-local" href="#message_directed_areas.Parameters.fields"><span class="parameter">fields</span></a><span class="text.normal"> are contained in </span><a class="factor-local" href="#message_directed_areas.Parameters.arrows"><span class="parameter">arrows</span></a><span class="text.normal">.</span></p></section><h1 class="footing"></h1></main></body></html>