<html root="2"><head><title>fault.internet.http</title><meta charset="utf-8"/><link as="style" rel="preload" href="../../.legacy-web/core.css"></link><link as="style" rel="preload" href="../../.legacy-web/factor.css"></link><link rel="stylesheet" href="../../.legacy-web/core.css"></link><link rel="stylesheet" href="../../.legacy-web/factor.css"></link></head><body><main><h1><span class="prefix"></span><div class="page-subject"><img class="icon" src="../../.factor-type-icon/if.fault.io/python-module.svg"></img><span class="subject-identifier">http</span><a href="http://if.fault.io/factors/python.module"><code class="type">python.module</code></a></div><div class="page-context"><a href="../"><img class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTYiIGhlaWdodD0iMjU2Ij48dGV4dCB4PSI0IiB5PSIwLjg4ZW0iIGZvbnQtc2l6ZT0iMjQ4Ij7wn5OhPC90ZXh0Pjwvc3ZnPg=="></img></a><span class="context-identifier">fault.internet</span></div></h1><section class="chapter"><p><span class="text.normal">Low-level Hypertext Transfer Protocol tools.</span></p><p><span class="text.normal">Provides protocol tokenization, field parsers, and protocol serialization for</span><span class="text.line-break"> </span><span class="text.normal">implementing a server or a client.</span></p></section><section class="unspecified" documented="true" local-identifier="Events" id="Events"><h1><span class="prefix"></span><a class="title" href="#Events"><span class="text.normal">Events</span></a><span class="abstract-type"></span></h1><dl class="text.mapping"><div id="Events.BYPASS" documented="true"><dt><a class="dkn" href="#Events.BYPASS"></a><span class="directory-key"><code class="id">BYPASS</code></span></dt><dd><div class="status"></div><p><span class="text.normal">(</span><a class="factor-local" href="#ev_bypass"><span class="data">ev_bypass</span></a><span class="text.normal">, </span><a class="invalid" href="#bytes"><span class="unknown">bytes</span></a><span class="text.normal">)</span></p></dd></div><div id="Events.RLINE" documented="true"><dt><a class="dkn" href="#Events.RLINE"></a><span class="directory-key"><code class="id">RLINE</code></span></dt><dd><div class="status"></div><p><span class="text.normal">For requests: (</span><a class="factor-local" href="#ev_rline"><span class="data">ev_rline</span></a><span class="text.normal">, (method, uri, version))</span><span class="text.line-break"> </span><span class="text.normal">For responses: (</span><a class="factor-local" href="#ev_rline"><span class="data">ev_rline</span></a><span class="text.normal">, (version, response_code, description))</span></p></dd></div><div id="Events.CHUNK" documented="true"><dt><a class="dkn" href="#Events.CHUNK"></a><span class="directory-key"><code class="id">CHUNK</code></span></dt><dd><div class="status"></div><p><span class="text.normal">(</span><a class="factor-local" href="#ev_chunk"><span class="data">ev_chunk</span></a><span class="text.normal">, </span><a class="invalid" href="#bytearray"><span class="unknown">bytearray</span></a><span class="text.normal">)</span></p></dd></div><div id="Events.CONTENT" documented="true"><dt><a class="dkn" href="#Events.CONTENT"></a><span class="directory-key"><code class="id">CONTENT</code></span></dt><dd><div class="status"></div><p><span class="text.normal">(</span><a class="factor-local" href="#ev_content"><span class="data">ev_content</span></a><span class="text.normal">, </span><a class="invalid" href="#bytearray"><span class="unknown">bytearray</span></a><span class="text.normal">)</span></p></dd></div><div id="Events.HEADERS" documented="true"><dt><a class="dkn" href="#Events.HEADERS"></a><span class="directory-key"><code class="id">HEADERS</code></span></dt><dd><div class="status"></div><p><span class="text.normal">(</span><a class="factor-local" href="#ev_headers"><span class="data">ev_headers</span></a><span class="text.normal">, [(</span><a class="invalid" href="#bytes"><span class="unknown">bytes</span></a><span class="text.normal">, </span><a class="invalid" href="#bytes"><span class="unknown">bytes</span></a><span class="text.normal">),...])</span></p></dd></div><div id="Events.TRAILERS" documented="true"><dt><a class="dkn" href="#Events.TRAILERS"></a><span class="directory-key"><code class="id">TRAILERS</code></span></dt><dd><div class="status"></div><p><span class="text.normal">(</span><a class="factor-local" href="#ev_trailers"><span class="data">ev_trailers</span></a><span class="text.normal">, [(</span><a class="invalid" href="#bytes"><span class="unknown">bytes</span></a><span class="text.normal">, </span><a class="invalid" href="#bytes"><span class="unknown">bytes</span></a><span class="text.normal">),...])</span></p></dd></div><div id="Events.MESSAGE" documented="true"><dt><a class="dkn" href="#Events.MESSAGE"></a><span class="directory-key"><code class="id">MESSAGE</code></span></dt><dd><div class="status"></div><p><span class="text.normal">(</span><a class="factor-local" href="#ev_message"><span class="data">ev_message</span></a><span class="text.normal">, </span><a class="invalid" href="#None"><span class="unknown">None</span></a><span class="text.normal">)</span><span class="text.line-break"> </span><span class="text.normal">End of message.</span></p></dd></div><div id="Events.VIOLATION" documented="true"><dt><a class="dkn" href="#Events.VIOLATION"></a><span class="directory-key"><code class="id">VIOLATION</code></span></dt><dd><div class="status"></div><p><span class="text.normal">(</span><a class="factor-local" href="#ev_trailers"><span class="data">ev_trailers</span></a><span class="text.normal">, (type, identifier, message, context))</span></p><p><span class="text.normal">Where </span><code class="">type</code><span class="text.normal"> is:</span></p><dl class="text.mapping"><div id="Events.VIOLATION.'limit'" documented="true"><dt><a class="dkn" href="#Events.VIOLATION.'limit'"></a><span class="directory-key"><code class="">'limit'</code></span></dt><dd><div class="status"></div><p><span class="text.normal">A configured limit was exceeded.</span></p></dd></div><div id="Events.VIOLATION.'protocol'" documented="true"><dt><a class="dkn" href="#Events.VIOLATION.'protocol'"></a><span class="directory-key"><code class="">'protocol'</code></span></dt><dd><div class="status"></div><p><span class="text.normal">A protocol error occurred.</span></p></dd></div></dl></dd></div><div id="Events.WARNING" documented="true"><dt><a class="dkn" href="#Events.WARNING"></a><span class="directory-key"><code class="id">WARNING</code></span></dt><dd><div class="status"></div><p><span class="text.normal">(</span><a class="factor-local" href="#ev_warning"><span class="data">ev_warning</span></a><span class="text.normal">, (type, identifier, message, context))</span></p></dd></div></dl></section><section class="import" documented="false" local-identifier="typing" id="typing"><h1><span class="prefix"></span><a class="title" href="#typing"><span class="text.normal">typing</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="itertools" id="itertools"><h1><span class="prefix"></span><a class="title" href="#itertools"><span class="text.normal">itertools</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="functools" id="functools"><h1><span class="prefix"></span><a class="title" href="#functools"><span class="text.normal">functools</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="dataclass" id="dataclass"><h1><span class="prefix"></span><a class="title" href="#dataclass"><span class="text.normal">dataclass</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="protocoldata" id="protocoldata"><h1><span class="prefix"></span><a class="title" href="#protocoldata"><span class="text.normal">protocoldata</span></a><span class="abstract-type">import</span></h1></section><section class="data" documented="false" local-identifier="ev_bypass" id="ev_bypass"><h1><span class="prefix"></span><a class="title" href="#ev_bypass"><span class="text.normal">ev_bypass</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_bypass = -2
</code></pre></section><section class="data" documented="false" local-identifier="ev_violation" id="ev_violation"><h1><span class="prefix"></span><a class="title" href="#ev_violation"><span class="text.normal">ev_violation</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_violation = -1
</code></pre></section><section class="data" documented="false" local-identifier="ev_rline" id="ev_rline"><h1><span class="prefix"></span><a class="title" href="#ev_rline"><span class="text.normal">ev_rline</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_rline = 0
</code></pre></section><section class="data" documented="false" local-identifier="ev_headers" id="ev_headers"><h1><span class="prefix"></span><a class="title" href="#ev_headers"><span class="text.normal">ev_headers</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_headers = 1
</code></pre></section><section class="data" documented="false" local-identifier="ev_content" id="ev_content"><h1><span class="prefix"></span><a class="title" href="#ev_content"><span class="text.normal">ev_content</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_content = 2
</code></pre></section><section class="data" documented="false" local-identifier="ev_chunk" id="ev_chunk"><h1><span class="prefix"></span><a class="title" href="#ev_chunk"><span class="text.normal">ev_chunk</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_chunk = 3
</code></pre></section><section class="data" documented="false" local-identifier="ev_trailers" id="ev_trailers"><h1><span class="prefix"></span><a class="title" href="#ev_trailers"><span class="text.normal">ev_trailers</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_trailers = 4
</code></pre></section><section class="data" documented="false" local-identifier="ev_message" id="ev_message"><h1><span class="prefix"></span><a class="title" href="#ev_message"><span class="text.normal">ev_message</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_message = 5 # end of message
</code></pre></section><section class="data" documented="false" local-identifier="ev_warning" id="ev_warning"><h1><span class="prefix"></span><a class="title" href="#ev_warning"><span class="text.normal">ev_warning</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_warning = 6
</code></pre></section><section class="data" documented="false" local-identifier="ev_wire" id="ev_wire"><h1><span class="prefix"></span><a class="title" href="#ev_wire"><span class="text.normal">ev_wire</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">ev_wire = -3 # Serialization event for signalling raw transfer.
</code></pre></section><section class="data" documented="false" local-identifier="event_symbols" id="event_symbols"><h1><span class="prefix"></span><a class="title" href="#event_symbols"><span class="text.normal">event_symbols</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">event_symbols = {
	ev_bypass: 'bypass',
	ev_violation: 'violation',
	ev_rline: 'rline',
	ev_headers: 'headers',
	ev_content: 'content',
	ev_chunk: 'chunk',
	ev_trailers: 'trailers',
	ev_message: 'message',
	ev_warning: 'warning',
}
</code></pre></section><section class="data" documented="false" local-identifier="EOH" id="EOH"><h1><span class="prefix"></span><a class="title" href="#EOH"><span class="text.normal">EOH</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">EOH = (ev_headers, ())
</code></pre></section><section class="data" documented="false" local-identifier="EOM" id="EOM"><h1><span class="prefix"></span><a class="title" href="#EOM"><span class="text.normal">EOM</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">EOM = (ev_message, None)

@dataclass
</code></pre></section><section class="class" documented="true" local-identifier="Limits" id="Limits"><h1><span class="prefix"></span><a class="title" href="#Limits"><span class="text.normal">Limits</span></a><span class="abstract-type">class</span></h1><div class="inheritance"><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></div><p><span class="text.normal">A set of numeric values used to define the limitations that should be enforced upon</span><span class="text.line-break"> </span><span class="text.normal">protocol elements when interpreting HTTP data as events.</span></p><section class="unspecified" documented="true" local-identifier="Properties" id="Limits.Properties"><h1 class="integrate"><span class="prefix"></span><a class="section" href="#Limits">Limits</a><a class="title" href="#Limits.Properties"><span class="text.normal">Properties</span></a><span class="abstract-type"></span></h1><dl class="text.mapping"><div id="Limits.Properties.max_line_size" documented="true"><dt><a class="dkn" href="#Limits.Properties.max_line_size"></a><span class="directory-key"><span class="text.normal">max_line_size</span></span></dt><dd><div class="status"></div><p><span class="text.normal">Maximum length of the Request-Line or Response-Line.</span></p></dd></div><div id="Limits.Properties.max_headers" documented="true"><dt><a class="dkn" href="#Limits.Properties.max_headers"></a><span class="directory-key"><span class="text.normal">max_headers</span></span></dt><dd><div class="status"></div><p><span class="text.normal">Maximum number of headers to accept.</span></p></dd></div><div id="Limits.Properties.max_trailers" documented="true"><dt><a class="dkn" href="#Limits.Properties.max_trailers"></a><span class="directory-key"><span class="text.normal">max_trailers</span></span></dt><dd><div class="status"></div><p><span class="text.normal">Maximum number of trailers to accept.</span></p></dd></div><div id="Limits.Properties.max_header_size" documented="true"><dt><a class="dkn" href="#Limits.Properties.max_header_size"></a><span class="directory-key"><span class="text.normal">max_header_size</span></span></dt><dd><div class="status"></div><p><span class="text.normal">len(field-name) + len(field-value)</span></p></dd></div><div id="Limits.Properties.max_header_set_size" documented="true"><dt><a class="dkn" href="#Limits.Properties.max_header_set_size"></a><span class="directory-key"><span class="text.normal">max_header_set_size</span></span></dt><dd><div class="status"></div><p><span class="text.normal">Maximum size to scan for EOH.</span></p></dd></div><div id="Limits.Properties.max_trailer_size" documented="true"><dt><a class="dkn" href="#Limits.Properties.max_trailer_size"></a><span class="directory-key"><span class="text.normal">max_trailer_size</span></span></dt><dd><div class="status"></div><p><span class="text.normal">len(field-name) + len(field-value)</span></p></dd></div><div id="Limits.Properties.max_chunk_line_size" documented="true"><dt><a class="dkn" href="#Limits.Properties.max_chunk_line_size"></a><span class="directory-key"><span class="text.normal">max_chunk_line_size</span></span></dt><dd><div class="status"></div><p><span class="text.normal">Chunk size portion, not the chunk data size.</span></p></dd></div></dl></section><section class="data" documented="false" local-identifier="max_line_size" id="Limits.max_line_size"><h1><span class="prefix"></span><a class="section" href="#Limits">Limits</a><a class="title" href="#Limits.max_line_size"><span class="text.normal">max_line_size</span></a><span class="abstract-type">data</span><code class="type"><a class="invalid" href="#int"><span class="unknown">int</span></a></code></h1><pre class="text.syntax"><code class="source">max_line_size: int = 4096
</code></pre></section><section class="data" documented="false" local-identifier="max_headers" id="Limits.max_headers"><h1><span class="prefix"></span><a class="section" href="#Limits">Limits</a><a class="title" href="#Limits.max_headers"><span class="text.normal">max_headers</span></a><span class="abstract-type">data</span><code class="type"><a class="invalid" href="#int"><span class="unknown">int</span></a></code></h1><pre class="text.syntax"><code class="source">max_headers: int = 1024
</code></pre></section><section class="data" documented="false" local-identifier="max_trailers" id="Limits.max_trailers"><h1><span class="prefix"></span><a class="section" href="#Limits">Limits</a><a class="title" href="#Limits.max_trailers"><span class="text.normal">max_trailers</span></a><span class="abstract-type">data</span><code class="type"><a class="invalid" href="#int"><span class="unknown">int</span></a></code></h1><pre class="text.syntax"><code class="source">max_trailers: int = 32
</code></pre></section><section class="data" documented="false" local-identifier="max_header_size" id="Limits.max_header_size"><h1><span class="prefix"></span><a class="section" href="#Limits">Limits</a><a class="title" href="#Limits.max_header_size"><span class="text.normal">max_header_size</span></a><span class="abstract-type">data</span><code class="type"><a class="invalid" href="#int"><span class="unknown">int</span></a></code></h1><pre class="text.syntax"><code class="source">max_header_size: int = 1024*4
</code></pre></section><section class="data" documented="false" local-identifier="max_header_set_size" id="Limits.max_header_set_size"><h1><span class="prefix"></span><a class="section" href="#Limits">Limits</a><a class="title" href="#Limits.max_header_set_size"><span class="text.normal">max_header_set_size</span></a><span class="abstract-type">data</span><code class="type"><a class="invalid" href="#int"><span class="unknown">int</span></a></code></h1><pre class="text.syntax"><code class="source">max_header_set_size: int = 1024*8*2
</code></pre></section><section class="data" documented="false" local-identifier="max_trailer_size" id="Limits.max_trailer_size"><h1><span class="prefix"></span><a class="section" href="#Limits">Limits</a><a class="title" href="#Limits.max_trailer_size"><span class="text.normal">max_trailer_size</span></a><span class="abstract-type">data</span><code class="type"><a class="invalid" href="#int"><span class="unknown">int</span></a></code></h1><pre class="text.syntax"><code class="source">max_trailer_size: int = 1024
</code></pre></section><section class="data" documented="false" local-identifier="max_chunk_line_size" id="Limits.max_chunk_line_size"><h1><span class="prefix"></span><a class="section" href="#Limits">Limits</a><a class="title" href="#Limits.max_chunk_line_size"><span class="text.normal">max_chunk_line_size</span></a><span class="abstract-type">data</span><code class="type"><a class="invalid" href="#int"><span class="unknown">int</span></a></code></h1><pre class="text.syntax"><code class="source">max_chunk_line_size: int = 1024
</code></pre></section></section><section class="function" documented="true" local-identifier="Tokenization" id="Tokenization"><h1><span class="prefix"></span><a class="title" href="#Tokenization"><span class="text.normal">Tokenization</span></a><span class="abstract-type">function</span></h1><p><code class="signature">Tokenization()</code></p><p><span class="text.normal">An HTTP 1.0 and 1.1 message parser. Emits HTTP events from the given binary data.</span><span class="text.line-break"> </span><span class="text.normal">For proper response handling(HEAD), </span><a class="factor-local" href="#Tokenization.Parameters.allocation"><span class="parameter">allocation</span></a><span class="text.normal"> must be properly constructed to retrieve</span><span class="text.line-break"> </span><span class="text.normal">the identifier and body expectation from the shared state.</span></p><p><span class="text.normal">The generator is configured to continue as long as the given </span><a class="factor-local" href="#Tokenization.Parameters.allocation"><span class="parameter">allocation</span></a><span class="text.line-break"> </span><span class="text.normal">iterator produces items.</span></p><p><span class="text.normal">Primarily, this generator is concernced with:</span><span class="text.line-break"> </span><a class="absolute" href="https://tools.ietf.org/html/rfc7230#section-3.3.3">https://tools.ietf.org/html/rfc7230#section-3.3.3</a></p></section><section class="data" documented="false" local-identifier="Disassembler" id="Disassembler"><h1><span class="prefix"></span><a class="title" href="#Disassembler"><span class="text.normal">Disassembler</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">Disassembler = Tokenization
</code></pre></section><section class="function" documented="true" local-identifier="disassembly" id="disassembly"><h1><span class="prefix"></span><a class="title" href="#disassembly"><span class="text.normal">disassembly</span></a><span class="abstract-type">function</span></h1><p><code class="signature">disassembly(**config)</code></p><p><span class="text.normal">Returns an already started </span><a class="factor-local" href="#Disassembler"><span class="data">Disassembler</span></a><span class="text.normal"> generator.</span></p></section><section class="function" documented="true" local-identifier="headers" id="headers"><h1><span class="prefix"></span><a class="title" href="#headers"><span class="text.normal">headers</span></a><span class="abstract-type">function</span></h1><p><code class="signature">headers(headers)</code></p><p><span class="text.normal">Produce an iterator of </span><a class="invalid" href="#bytes"><span class="unknown">bytes</span></a><span class="text.normal"> instances making up a segment</span><span class="text.line-break"> </span><span class="text.normal">of headers that can be joined into a buffer.</span></p></section><section class="data" documented="false" local-identifier="trailers" id="trailers"><h1><span class="prefix"></span><a class="title" href="#trailers"><span class="text.normal">trailers</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">trailers = headers

@functools.lru_cache(16)
</code></pre></section><section class="function" documented="false" local-identifier="chunk_size" id="chunk_size"><h1><span class="prefix"></span><a class="title" href="#chunk_size"><span class="text.normal">chunk_size</span></a><span class="abstract-type">function</span></h1><p><code class="signature">chunk_size(length)</code></p></section><section class="function" documented="true" local-identifier="chunk" id="chunk"><h1><span class="prefix"></span><a class="title" href="#chunk"><span class="text.normal">chunk</span></a><span class="abstract-type">function</span></h1><p><code class="signature">chunk(data)</code></p><p><span class="text.normal">Returns a tuple of (chunk-size + CRLF, chunk-data, CRLF).</span></p><p><span class="text.normal">Joining data into a single buffer is avoided for the express</span><span class="text.line-break"> </span><span class="text.normal">purpose of allowing the data buffer to be passed through.</span><span class="text.line-break"> </span><span class="text.normal">In cases where a shared memory segment is referenced, this</span><span class="text.line-break"> </span><span class="text.normal">can be critical for proper performance.</span></p><p><span class="text.normal">Currently, </span><a class="factor-local" href="#Serialization"><span class="function">Serialization</span></a><span class="text.normal"> will concatenate these, defeating</span><span class="text.line-break"> </span><span class="text.normal">some of the purpose.</span></p><pre class="text.syntax"><code class="/pl/python">assert chunk(b"data") == (b"4\r\n", b"data", b"\r\n")
</code></pre></section><section class="function" documented="true" local-identifier="Serialization" id="Serialization"><h1><span class="prefix"></span><a class="title" href="#Serialization"><span class="text.normal">Serialization</span></a><span class="abstract-type">function</span></h1><p><code class="signature">Serialization()</code></p><p><span class="text.normal">Assemble HTTP events back into a sequences of bytes.</span></p></section><section class="data" documented="false" local-identifier="Assembler" id="Assembler"><h1><span class="prefix"></span><a class="title" href="#Assembler"><span class="text.normal">Assembler</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">Assembler = Serialization
</code></pre></section><section class="function" documented="true" local-identifier="assembly" id="assembly"><h1><span class="prefix"></span><a class="title" href="#assembly"><span class="text.normal">assembly</span></a><span class="abstract-type">function</span></h1><p><code class="signature">assembly(**config)</code></p><p><span class="text.normal">Return a started </span><a class="factor-local" href="#Assembler"><span class="data">Assembler</span></a><span class="text.normal"> generator.</span></p></section><h1 class="footing"></h1></main></body></html>