<html root="2"><head><title>fault.internet.xml</title><meta charset="utf-8"/><link as="style" rel="preload" href="../../.legacy-web/core.css"></link><link as="style" rel="preload" href="../../.legacy-web/factor.css"></link><link rel="stylesheet" href="../../.legacy-web/core.css"></link><link rel="stylesheet" href="../../.legacy-web/factor.css"></link></head><body><main><h1><span class="prefix"></span><div class="page-subject"><img class="icon" src="../../.factor-type-icon/if.fault.io/python-module.svg"></img><span class="subject-identifier">xml</span><a href="http://if.fault.io/factors/python.module"><code class="type">python.module</code></a></div><div class="page-context"><a href="../"><img class="icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTYiIGhlaWdodD0iMjU2Ij48dGV4dCB4PSI0IiB5PSIwLjg4ZW0iIGZvbnQtc2l6ZT0iMjQ4Ij7wn5OhPC90ZXh0Pjwvc3ZnPg=="></img></a><span class="context-identifier">fault.internet</span></div></h1><section class="chapter"><p><span class="text.normal">Nested generator based HTML/XML serialization module.</span></p><p><span class="text.normal">Provides primitives for generating XML using nested generators.</span></p></section><section class="unspecified" documented="true" local-identifier="Properties" id="Properties"><h1><span class="prefix"></span><a class="title" href="#Properties"><span class="text.normal">Properties</span></a><span class="abstract-type"></span></h1><dl class="text.mapping"><div id="Properties.namespaces" documented="true"><dt><a class="dkn" href="#Properties.namespaces"></a><span class="directory-key"><span class="text.normal">namespaces</span></span></dt><dd><div class="status"></div><p><span class="text.normal">Common namespace labels for various XML namespaces.</span></p></dd></div></dl></section><section class="import" documented="false" local-identifier="functools" id="functools"><h1><span class="prefix"></span><a class="title" href="#functools"><span class="text.normal">functools</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="itertools" id="itertools"><h1><span class="prefix"></span><a class="title" href="#itertools"><span class="text.normal">itertools</span></a><span class="abstract-type">import</span></h1></section><section class="import" documented="false" local-identifier="typing" id="typing"><h1><span class="prefix"></span><a class="title" href="#typing"><span class="text.normal">typing</span></a><span class="abstract-type">import</span></h1></section><section class="data" documented="false" local-identifier="namespaces" id="namespaces"><h1><span class="prefix"></span><a class="title" href="#namespaces"><span class="text.normal">namespaces</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">namespaces = (
	('xml', "http://www.w3.org/XML/1998/namespace"),
	('xmlns', "http://www.w3.org/2000/xmlns/"),
	('schema', "http://www.w3.org/2001/XMLSchema"),
	('schema-datatypes', "http://www.w3.org/2001/XMLSchema-datatypes"),
	('relaxng', "http://relaxng.org/ns/structure/1.0"),
	('schematron', "http://www.ascc.net/xml/schematron"),
	('rdf', "http://www.w3.org/1999/02/22-rdf-syntax-ns#"),
	('xlink', "http://www.w3.org/1999/xlink"),
	('xinclude', "http://www.w3.org/2001/XInclude"),
	('xslt', "http://www.w3.org/1999/XSL/Transform"),
	('xhtml', "http://www.w3.org/1999/xhtml"),
	('svg', "http://www.w3.org/2000/svg"),
	('mathml', "http://www.w3.org/1998/Math/MathML"),
	('l', "http://if.fault.io/xml/literals"),
)
</code></pre></section><section class="function" documented="true" local-identifier="escape_element_bytes" id="escape_element_bytes"><h1><span class="prefix"></span><a class="title" href="#escape_element_bytes"><span class="text.normal">escape_element_bytes</span></a><span class="abstract-type">function</span></h1><p><code class="signature">escape_element_bytes(data)</code></p><p><span class="text.normal">Escape bytes instances for storage inside an XML element.</span><span class="text.line-break"> </span><a class="invalid" href="#bytes"><span class="unknown">bytes</span></a><span class="text.normal"> instances are yielded out as there may be a series of</span><span class="text.line-break"> </span><span class="text.normal">CDATA sections, and </span><a class="factor-local" href="#element"><span class="data">element</span></a><span class="text.normal"> works with iterators when dealing</span><span class="text.line-break"> </span><span class="text.normal">with content.</span></p><p><span class="text.normal">This returns an iterable suitable for use by </span><a class="factor-local" href="#element"><span class="data">element</span></a><span class="text.normal">.</span></p></section><section class="function" documented="true" local-identifier="escape_element_string" id="escape_element_string"><h1><span class="prefix"></span><a class="title" href="#escape_element_string"><span class="text.normal">escape_element_string</span></a><span class="abstract-type">function</span></h1><p><code class="signature">escape_element_string(string)</code></p><p><span class="text.normal">Escape and encode an arbitrary string for storage inside an</span><span class="text.line-break"> </span><span class="text.normal">XML element body. This depends on </span><a class="factor-local" href="#escape_element_bytes"><span class="function">escape_element_bytes</span></a><span class="text.line-break"> </span><span class="text.normal">and has the same limitations with respect to control characters.</span></p><p><span class="text.normal">This returns an iterable suitable for use by </span><a class="factor-local" href="#element"><span class="data">element</span></a><span class="text.normal">.</span></p></section><section class="function" documented="true" local-identifier="escape_attribute_string" id="escape_attribute_string"><h1><span class="prefix"></span><a class="title" href="#escape_attribute_string"><span class="text.normal">escape_attribute_string</span></a><span class="abstract-type">function</span></h1><p><code class="signature">escape_attribute_string(string)</code></p><p><span class="text.normal">Escape the given string for inclusion in an attribute value.</span><span class="text.line-break"> </span><span class="text.normal">Does </span><span class="text.emphasis">not</span><span class="text.normal"> encode the result string.</span></p><div class="admonition-WARNING"><table><tr><td><span class="admonition.icon"></span></td><td><span class="admonition.severity">WARNING</span></td></tr><tr><td></td><td><div class="admonition.content"><p><span class="text.normal">This function only escapes ampersands, less-than comparison</span><span class="text.line-break"> </span><span class="text.normal">characters, and quotes. Low-ASCII will not be escaped and must</span><span class="text.line-break"> </span><span class="text.normal">be processed by a distinct function. This should only be used in cases</span><span class="text.line-break"> </span><span class="text.normal">where the source is known to not produce low-ASCII.</span></p></div></td></tr></table></div></section><section class="function" documented="true" local-identifier="attribute" id="attribute"><h1><span class="prefix"></span><a class="title" href="#attribute"><span class="text.normal">attribute</span></a><span class="abstract-type">function</span><code class="type"><a class="factor-local" href="#attribute.Parameters.str"><span class="parameter">str</span></a></code></h1><p><code class="signature">attribute(identifier, value)</code></p><p><span class="text.normal">Construct an XML attribute from the identifier and its value.</span></p><p><span class="text.normal">Does not encode the result string, and attribute values are subjected</span><span class="text.line-break"> </span><span class="text.normal">to the effect of </span><a class="factor-local" href="#escape_attribute_string"><span class="function">escape_attribute_string</span></a><span class="text.normal">.</span></p><p><span class="text.normal">Returns a </span><a class="factor-local" href="#attribute.Parameters.str"><span class="parameter">str</span></a><span class="text.normal"> as they are normally interpolated inside </span><a class="factor-local" href="#encode_element"><span class="function">encode_element</span></a><span class="text.normal">.</span></p></section><section class="function" documented="true" local-identifier="empty" id="empty"><h1><span class="prefix"></span><a class="title" href="#empty"><span class="text.normal">empty</span></a><span class="abstract-type">function</span></h1><p><code class="signature">empty(element_identifier)</code></p><p><span class="text.normal">Return an iterable to an empty element.</span></p></section><section class="function" documented="true" local-identifier="encode_element" id="encode_element"><h1><span class="prefix"></span><a class="title" href="#encode_element"><span class="text.normal">encode_element</span></a><span class="abstract-type">function</span></h1><p><code class="signature">encode_element(encoding, element_identifier, content, *attribute_sequence, **attributes)</code></p><p><span class="text.normal">Generate an entire element populating the body by yielding from the given content.</span></p></section><section class="data" documented="false" local-identifier="element" id="element"><h1><span class="prefix"></span><a class="title" href="#element"><span class="text.normal">element</span></a><span class="abstract-type">data</span></h1><pre class="text.syntax"><code class="source">element = functools.partial(encode_element, 'utf-8')
</code></pre></section><section class="class" documented="true" local-identifier="Serialization" id="Serialization"><h1><span class="prefix"></span><a class="title" href="#Serialization"><span class="text.normal">Serialization</span></a><span class="abstract-type">class</span></h1><div class="inheritance"><code class="type"><a class="invalid" href="#object"><span class="unknown">object</span></a></code></div><p><span class="text.normal">Base class for XML serialization instances.</span><span class="text.line-break"> </span><span class="text.normal">Used to localize encoding bindings and default element prefixes.</span></p><p><span class="text.normal">After a Serialization instance is initialized,</span><span class="text.line-break"> </span><span class="text.normal">the </span><a class="factor-local" href="#Serialization.element"><span class="method">element</span></a><span class="text.normal"> and </span><a class="factor-local" href="#Serialization.escape"><span class="method">escape</span></a><span class="text.normal"> attributes will be available for use</span><span class="text.line-break"> </span><span class="text.normal">as they depend on the encoding. Serialization is strictly concerned</span><span class="text.line-break"> </span><span class="text.normal">with the binary emission of a document built for nested iterators.</span></p><section class="unspecified" documented="true" local-identifier="Properties" id="Serialization.Properties"><h1 class="integrate"><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.Properties"><span class="text.normal">Properties</span></a><span class="abstract-type"></span></h1><dl class="text.mapping"><div id="Serialization.Properties.xml_prefix" documented="true"><dt><a class="dkn" href="#Serialization.Properties.xml_prefix"></a><span class="directory-key"><span class="text.normal">xml_prefix</span></span></dt><dd><div class="status"></div><p><span class="text.normal">The prefix to use when serializing elements with </span><a class="factor-local" href="#Serialization.prefixed"><span class="method">prefixed</span></a><span class="text.normal">.</span></p></dd></div><div id="Serialization.Properties.xml_encoding" documented="true"><dt><a class="dkn" href="#Serialization.Properties.xml_encoding"></a><span class="directory-key"><span class="text.normal">xml_encoding</span></span></dt><dd><div class="status"></div><p><span class="text.normal">The encoding to use when serializing </span><a class="invalid" href="#str"><span class="unknown">str</span></a><span class="text.normal"> objects.</span></p></dd></div></dl></section><section class="method" documented="true" local-identifier="__init__" id="Serialization.__init__"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.__init__"><span class="text.normal">__init__</span></a><span class="abstract-type">method</span></h1><p><code class="signature">__init__(self)</code></p><p><span class="text.normal">Initialize the serializer to write XML data in the given encoding.</span></p></section><section class="method" documented="true" local-identifier="declaration" id="Serialization.declaration"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.declaration"><span class="text.normal">declaration</span></a><span class="abstract-type">method</span></h1><p><code class="signature">declaration(self, standalone)</code></p><p><span class="text.normal">Construct and return an ASCII encoded string representing</span><span class="text.line-break"> </span><span class="text.normal">the declaration consistent with the Serialization context.</span></p><section class="unspecified" documented="true" local-identifier="Parameters" id="Serialization.declaration.Parameters"><h1 class="integrate"><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="section" href="#Serialization.declaration">declaration</a><a class="title" href="#Serialization.declaration.Parameters"><span class="text.normal">Parameters</span></a><span class="abstract-type"></span></h1><dl class="text.mapping"><div id="Serialization.declaration.Parameters.self" class="parameter" documented="false"><dt><a class="dkn" href="#Serialization.declaration.Parameters.self"></a><span class="directory-key"><code class="parameter">self</code></span></dt><dd><div class="status"></div><p><code class="control.absent">Undocumented</code><span class="text.normal">.</span></p></dd></div><div id="Serialization.declaration.Parameters.standalone" class="parameter" documented="true"><dt><a class="dkn" href="#Serialization.declaration.Parameters.standalone"></a><span class="directory-key"><code class="parameter">standalone</code></span></dt><dd><div class="status"></div><p><span class="text.normal">The </span><code class="">standalone</code><span class="text.normal"> attribute for the declaration.</span></p></dd></div></dl></section></section><section class="method" documented="true" local-identifier="encode" id="Serialization.encode"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.encode"><span class="text.normal">encode</span></a><span class="abstract-type">method</span></h1><p><code class="signature">encode(self, string)</code></p><p><span class="text.normal">Encode the given string in the configured encoding with </span><code class="">'xmlcharrefreplace'</code><span class="text.line-break"> </span><span class="text.normal">on errors.</span></p><p><span class="text.normal">Returns the encoded string in a tuple for placement into </span><a class="factor-local" href="#Serialization.element"><span class="method">element</span></a><span class="text.normal"> calls.</span></p></section><section class="method" documented="true" local-identifier="empty" id="Serialization.empty"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.empty"><span class="text.normal">empty</span></a><span class="abstract-type">method</span></h1><p><code class="signature">empty(self, name, *args, **kw)</code></p><p><span class="text.normal">Construct an empty XML element with the attributes</span><span class="text.line-break"> </span><span class="text.normal">defined by parameters.</span></p></section><section class="method" documented="true" local-identifier="switch" id="Serialization.switch"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.switch"><span class="text.normal">switch</span></a><span class="abstract-type">method</span></h1><p><code class="signature">switch(self)</code></p><p><span class="text.normal">Create another </span><a class="factor-local" href="#Serialization"><span class="class">Serialization</span></a><span class="text.normal"> instance using a different prefix.</span></p></section><section class="method" documented="true" local-identifier="element" id="Serialization.element"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.element"><span class="text.normal">element</span></a><span class="abstract-type">method</span></h1><p><code class="signature">element(self, element_name, subnode_iterator, *attributes, **kwattributes)</code></p><p><span class="text.normal">Serialize an element with the exact </span><a class="factor-local" href="#Serialization.element.Parameters.element_name"><span class="parameter">element_name</span></a><span class="text.normal"> with the contents of</span><span class="text.line-break"> </span><a class="factor-local" href="#Serialization.element.Parameters.subnode_iterator"><span class="parameter">subnode_iterator</span></a><span class="text.normal"> as the inner nodes. </span><a class="factor-local" href="#Serialization.element.Parameters.subnode_iterator"><span class="parameter">subnode_iterator</span></a><span class="text.normal"> must produce</span><span class="text.line-break"> </span><a class="invalid" href="#bytes"><span class="unknown">bytes</span></a><span class="text.normal"> encoded objects.</span></p></section><section class="method" documented="true" local-identifier="prefixed" id="Serialization.prefixed"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.prefixed"><span class="text.normal">prefixed</span></a><span class="abstract-type">method</span></h1><p><code class="signature">prefixed(self, element_name, *args, **kw)</code></p><p><span class="text.normal">Serialize an element using </span><a class="factor-local" href="#Serialization.element"><span class="method">element</span></a><span class="text.normal">, but prefix the element name with</span><span class="text.line-break"> </span><span class="text.normal">prefix configured at </span><a class="invalid" href="#xml_prefix"><span class="unknown">xml_prefix</span></a><span class="text.normal">.</span></p><p><span class="text.normal">The configured prefix may or may not be an XML namespace.</span></p></section><section class="method" documented="true" local-identifier="pi" id="Serialization.pi"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.pi"><span class="text.normal">pi</span></a><span class="abstract-type">method</span></h1><p><code class="signature">pi(self, target, data)</code></p><p><span class="text.normal">Emit an XML Processing Instruction.</span></p><p><span class="text.normal">Processing Instruction productions are different than </span><a class="factor-local" href="#Serialization.element"><span class="method">element</span></a><span class="text.line-break"> </span><span class="text.normal">productions as a single string is returned rather than an iterator.</span></p></section><section class="method" documented="true" local-identifier="root" id="Serialization.root"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.root"><span class="text.normal">root</span></a><span class="abstract-type">method</span></h1><p><code class="signature">root(self, name, content, *attributes)</code></p><p><span class="text.normal">Construct the root element of a document.</span></p></section><section class="method" documented="true" local-identifier="literal" id="Serialization.literal"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.literal"><span class="text.normal">literal</span></a><span class="abstract-type">method</span></h1><p><code class="signature">literal(self, ordinal)</code></p><p><span class="text.normal">Create a literal element used to represent a disallowed XML character.</span></p><p><span class="text.normal">Strict XML processing implementations may disallow many low-ascii characters,</span><span class="text.line-break"> </span><span class="text.emphasis">even when encoded as an entity</span><span class="text.normal">. This restriction is problematic as it</span><span class="text.line-break"> </span><span class="text.normal">requires some compensation when working with binary data.</span></p><p><a class="factor-local" href="#Serialization.literal"><span class="method">literal</span></a><span class="text.normal"> provides a way to escape any octet for encoding purposes. The given</span><span class="text.line-break"> </span><span class="text.normal">oridinal will be returned as an element in the </span><code class="">l</code><span class="text.normal"> namespace. When serializing</span><span class="text.line-break"> </span><span class="text.normal">XML output that exercises </span><a class="factor-local" href="#Serialization.literal"><span class="method">literal</span></a><span class="text.normal">, the </span><code class="xmlns:label">l</code><span class="text.normal"> namespace must be defined</span><span class="text.line-break"> </span><span class="text.normal">ahead of time.</span></p></section><section class="method" documented="true" local-identifier="text" id="Serialization.text"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.text"><span class="text.normal">text</span></a><span class="abstract-type">method</span></h1><p><code class="signature">text(self, *strings)</code></p><p><span class="text.normal">Emit a text node without escaping contents.</span><span class="text.line-break"> </span><span class="text.normal">Encoding errors will be raised.</span></p></section><section class="method" documented="true" local-identifier="escape" id="Serialization.escape"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.escape"><span class="text.normal">escape</span></a><span class="abstract-type">method</span></h1><p><code class="signature">escape(self, string)</code></p><p><span class="text.normal">Escape the given </span><a class="factor-local" href="#Serialization.escape.Parameters.string"><span class="parameter">string</span></a><span class="text.normal"> and encode it in the configured encoding.</span></p></section><section class="method" documented="true" local-identifier="hyperlink" id="Serialization.hyperlink"><h1><span class="prefix"></span><a class="section" href="#Serialization">Serialization</a><a class="title" href="#Serialization.hyperlink"><span class="text.normal">hyperlink</span></a><span class="abstract-type">method</span></h1><p><code class="signature">hyperlink(self, href)</code></p><p><span class="text.normal">Emit the default hyperlink attribute representation.</span></p></section></section><h1 class="footing"></h1></main></body></html>